import Ue from"buffer";import xt from"crypto";import De from"util";import vt from"stream";import Nt from"zlib";import At from"events";import mt from"fs";import gt from"path";import{randomUUID as tt}from"node:crypto";var It=Object.create,wt=Object.defineProperty,Ct=Object.getOwnPropertyDescriptor,bt=Object.getOwnPropertyNames,$t=Object.getPrototypeOf,Pt=Object.prototype.hasOwnProperty;var Ie=(u,l)=>function(){return l||(0,u[bt(u)[0]])((l={exports:{}}).exports,l),l.exports},Bt=(u,l,h,d)=>{if(l&&typeof l=="object"||typeof l=="function")for(let _ of bt(l))!Pt.call(u,_)&&_!==h&&wt(u,_,{get:()=>l[_],enumerable:!(d=Ct(l,_))||d.enumerable});return u},Lt=(u,l,h)=>(h=u!=null?It($t(u)):{},Bt(l||!u||!u.__esModule?wt(h,"default",{value:u,enumerable:!0}):h,u)),ze=Ie({"node_modules/avsc/lib/utils.js"(u,l){"use strict";var h=Ue,d=xt,_=De,g=h.Buffer,O=new S(4096),T=/^[A-Za-z_][A-Za-z0-9_]*$/,v=_.format;function R(c){return typeof g.alloc=="function"?g.alloc(c):new g(c)}function $(c,p){return typeof g.from=="function"?g.from(c,p):new g(c,p)}function P(c){return c.charAt(0).toUpperCase()+c.slice(1)}function Y(c,p){return c===p?0:c<p?-1:1}function te(c,p,b){var A=c[p];return A===void 0?b:A}function m(c,p){p=p||"md5";var b=d.createHash(p);return b.end(c),b.read()}function a(c,p){var b=-1,A,V;if(!c)return-1;for(A=0,V=c.length;A<V;A++)if(c[A]===p){if(b>=0)return-2;b=A}return b}function w(c,p){var b={},A,V;for(A=0;A<c.length;A++)V=c[A],b[p(V)]=V;return b}function j(c){return Object.keys(c).map(function(p){return c[p]})}function z(c,p){var b=Object.create(null),A,V,Z;for(A=0,V=c.length;A<V;A++){if(Z=c[A],p&&(Z=p(Z)),b[Z])return!0;b[Z]=!0}return!1}function ee(c,p,b){var A=Object.getOwnPropertyNames(c),V,Z,K;for(V=0,Z=A.length;V<Z;V++)if(K=A[V],!p.hasOwnProperty(K)||b){var ce=Object.getOwnPropertyDescriptor(c,K);Object.defineProperty(p,K,ce)}return p}function M(c){return T.test(c)}function G(c,p){return~c.indexOf(".")?c=c.replace(/^\./,""):p&&(c=p+"."+c),c.split(".").forEach(function(b){if(!M(b))throw new Error(v("invalid name: %j",c))}),c}function D(c){var p=c.split(".");return p[p.length-1]}function Q(c){var p=/^(.*)\.[^.]+$/.exec(c);return p?p[1]:void 0}function q(c,p){p=p|0;var b=c.charAt(p++);if(/[\d-]/.test(b)){for(;/[eE\d.+-]/.test(c.charAt(p));)p++;return p}else{if(/true|null/.test(c.slice(p-1,p+3)))return p+3;if(/false/.test(c.slice(p-1,p+4)))return p+4}var A=0,V=!1;do switch(b){case"{":case"[":V||A++;break;case"}":case"]":if(!V&&!--A)return p;break;case'"':if(V=!V,!A&&!V)return p;break;case"\\":p++}while(b=c.charAt(p++));return-1}function ne(){throw new Error("abstract")}function E(c,p){var b=c.prototype,A,V,Z,K;for(A=0,V=p.length;A<V;A++)Z=p[A],K="get"+P(Z),b[K]=_.deprecate(ce(Z),"use `."+Z+"` instead of `."+K+"()`");function ce(pe){return function(){var he=this[pe];return typeof he=="function"?he.apply(this,arguments):he}}}function S(c){this._len=c|0,this._pos=0,this._slab=R(this._len)}S.prototype.alloc=function(c){if(c<0)throw new Error("negative length");var p=this._len;return c>p?R(c):(this._pos+c>p&&(this._slab=R(p),this._pos=0),this._slab.slice(this._pos,this._pos+=c))};function N(c){var p=1103515245,b=12345,A=Math.pow(2,31),V=Math.floor(c||Math.random()*(A-1));this._max=A,this._nextInt=function(){return V=(p*V+b)%A}}N.prototype.nextBoolean=function(){return!!(this._nextInt()%2)},N.prototype.nextInt=function(c,p){return p===void 0&&(p=c,c=0),p=p===void 0?this._max:p,c+Math.floor(this.nextFloat()*(p-c))},N.prototype.nextFloat=function(c,p){return p===void 0&&(p=c,c=0),p=p===void 0?1:p,c+(p-c)*this._nextInt()/this._max},N.prototype.nextString=function(c,p){c|=0,p=p||"aA";var b="";p.indexOf("a")>-1&&(b+="abcdefghijklmnopqrstuvwxyz"),p.indexOf("A")>-1&&(b+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),p.indexOf("#")>-1&&(b+="0123456789"),p.indexOf("!")>-1&&(b+="~`!@#$%^&*()_+-={}[]:\";'<>?,./|\\");for(var A=[],V=0;V<c;V++)A.push(this.choice(b));return A.join("")},N.prototype.nextBuffer=function(c){var p=[],b;for(b=0;b<c;b++)p.push(this.nextInt(256));return $(p)},N.prototype.choice=function(c){var p=c.length;if(!p)throw new Error("choosing from empty array");return c[this.nextInt(p)]};function x(){this._index=0,this._items=[]}x.prototype.push=function(c){var p=this._items,b=p.length|0,A;for(p.push(c);b>0&&p[b].index<p[A=b-1>>1].index;)c=p[b],p[b]=p[A],p[A]=c,b=A},x.prototype.pop=function(){var c=this._items,p=c.length-1|0,b=c[0];if(!b||b.index>this._index)return null;if(this._index++,!p)return c.pop(),b;c[0]=c.pop();for(var A=p>>1,V=0,Z,K,ce,pe,he,ge,ve;V<A&&(pe=c[V],Z=(V<<1)+1,K=V+1<<1,ge=c[Z],ve=c[K],!ve||ge.index<=ve.index?(he=ge,ce=Z):(he=ve,ce=K),!(he.index>=pe.index));)c[ce]=pe,c[V]=he,V=ce;return b};function I(c,p){if(this.buf=c,this.pos=p|0,this.pos<0)throw new Error("negative offset")}I.prototype.isValid=function(){return this.pos<=this.buf.length},I.prototype._invalidate=function(){this.pos=this.buf.length+1},I.prototype.readBoolean=function(){return!!this.buf[this.pos++]},I.prototype.skipBoolean=function(){this.pos++},I.prototype.writeBoolean=function(c){this.buf[this.pos++]=!!c},I.prototype.readInt=I.prototype.readLong=function(){var c=0,p=0,b=this.buf,A,V,Z,K;do A=b[this.pos++],V=A&128,c|=(A&127)<<p,p+=7;while(V&&p<28);if(V){Z=c,K=268435456;do A=b[this.pos++],Z+=(A&127)*K,K*=128;while(A&128);return(Z%2?-(Z+1):Z)/2}return c>>1^-(c&1)},I.prototype.skipInt=I.prototype.skipLong=function(){for(var c=this.buf;c[this.pos++]&128;);},I.prototype.writeInt=I.prototype.writeLong=function(c){var p=this.buf,b,A;if(c>=-1073741824&&c<1073741824){A=c>=0?c<<1:~c<<1|1;do p[this.pos]=A&127,A>>=7;while(A&&(p[this.pos++]|=128))}else{b=c>=0?c*2:-c*2-1;do p[this.pos]=b&127,b/=128;while(b>=1&&(p[this.pos++]|=128))}this.pos++},I.prototype.readFloat=function(){var c=this.buf,p=this.pos;return this.pos+=4,this.pos>c.length?0:this.buf.readFloatLE(p)},I.prototype.skipFloat=function(){this.pos+=4},I.prototype.writeFloat=function(c){var p=this.buf,b=this.pos;if(this.pos+=4,!(this.pos>p.length))return this.buf.writeFloatLE(c,b)},I.prototype.readDouble=function(){var c=this.buf,p=this.pos;return this.pos+=8,this.pos>c.length?0:this.buf.readDoubleLE(p)},I.prototype.skipDouble=function(){this.pos+=8},I.prototype.writeDouble=function(c){var p=this.buf,b=this.pos;if(this.pos+=8,!(this.pos>p.length))return this.buf.writeDoubleLE(c,b)},I.prototype.readFixed=function(c){var p=this.pos;if(this.pos+=c,!(this.pos>this.buf.length)){var b=O.alloc(c);return this.buf.copy(b,0,p,p+c),b}},I.prototype.skipFixed=function(c){this.pos+=c},I.prototype.writeFixed=function(c,p){p=p||c.length;var b=this.pos;this.pos+=p,!(this.pos>this.buf.length)&&c.copy(this.buf,b,0,p)},I.prototype.readBytes=function(){var c=this.readLong();if(c<0){this._invalidate();return}return this.readFixed(c)},I.prototype.skipBytes=function(){var c=this.readLong();if(c<0){this._invalidate();return}this.pos+=c},I.prototype.writeBytes=function(c){var p=c.length;this.writeLong(p),this.writeFixed(c,p)},typeof g.prototype.utf8Slice=="function"?I.prototype.readString=function(){var c=this.readLong();if(c<0)return this._invalidate(),"";var p=this.pos,b=this.buf;if(this.pos+=c,!(this.pos>b.length))return this.buf.utf8Slice(p,p+c)}:I.prototype.readString=function(){var c=this.readLong();if(c<0)return this._invalidate(),"";var p=this.pos,b=this.buf;if(this.pos+=c,!(this.pos>b.length))return this.buf.slice(p,p+c).toString()},I.prototype.skipString=function(){var c=this.readLong();if(c<0){this._invalidate();return}this.pos+=c},I.prototype.writeString=function(c){var p=g.byteLength(c),b=this.buf;this.writeLong(p);var A=this.pos;if(this.pos+=p,!(this.pos>b.length))if(p>64&&typeof g.prototype.utf8Write=="function")b.utf8Write(c,A,p);else{var V,Z,K,ce;for(V=0,Z=p;V<Z;V++)K=c.charCodeAt(V),K<128?b[A++]=K:K<2048?(b[A++]=K>>6|192,b[A++]=K&63|128):(K&64512)===55296&&((ce=c.charCodeAt(V+1))&64512)===56320?(K=65536+((K&1023)<<10)+(ce&1023),V++,b[A++]=K>>18|240,b[A++]=K>>12&63|128,b[A++]=K>>6&63|128,b[A++]=K&63|128):(b[A++]=K>>12|224,b[A++]=K>>6&63|128,b[A++]=K&63|128)}},typeof g.prototype.latin1Write=="function"?I.prototype.writeBinary=function(c,p){var b=this.pos;this.pos+=p,!(this.pos>this.buf.length)&&this.buf.latin1Write(c,b,p)}:typeof g.prototype.binaryWrite=="function"?I.prototype.writeBinary=function(c,p){var b=this.pos;this.pos+=p,!(this.pos>this.buf.length)&&this.buf.binaryWrite(c,b,p)}:I.prototype.writeBinary=function(c,p){var b=this.pos;this.pos+=p,!(this.pos>this.buf.length)&&this.buf.write(c,b,p,"binary")},I.prototype.matchBoolean=function(c){return this.buf[this.pos++]-c.buf[c.pos++]},I.prototype.matchInt=I.prototype.matchLong=function(c){var p=this.readLong(),b=c.readLong();return p===b?0:p<b?-1:1},I.prototype.matchFloat=function(c){var p=this.readFloat(),b=c.readFloat();return p===b?0:p<b?-1:1},I.prototype.matchDouble=function(c){var p=this.readDouble(),b=c.readDouble();return p===b?0:p<b?-1:1},I.prototype.matchFixed=function(c,p){return this.readFixed(p).compare(c.readFixed(p))},I.prototype.matchBytes=I.prototype.matchString=function(c){var p=this.readLong(),b=this.pos;this.pos+=p;var A=c.readLong(),V=c.pos;c.pos+=A;var Z=this.buf.slice(b,this.pos),K=c.buf.slice(V,c.pos);return Z.compare(K)},I.prototype.unpackLongBytes=function(){var c=R(8),p=0,b=0,A=6,V=this.buf,Z,K;for(Z=V[this.pos++],K=Z&1,c.fill(0),p|=(Z&127)>>1;Z&128;)Z=V[this.pos++],p|=(Z&127)<<A,A+=7,A>=8&&(A-=8,c[b++]=p,p>>=8);return c[b]=p,K&&X(c,8),c},I.prototype.packLongBytes=function(c){var p=(c[7]&128)>>7,b=this.buf,A=1,V=0,Z=3,K;p?(X(c,8),K=1):K=0;for(var ce=[c.readUIntLE(0,3),c.readUIntLE(3,3),c.readUIntLE(6,2)];Z&&!ce[--Z];);for(;V<Z;)for(K|=ce[V++]<<A,A+=24;A>7;)b[this.pos++]=K&127|128,K>>=7,A-=7;K|=ce[Z]<<A;do b[this.pos]=K&127,K>>=7;while(K&&(b[this.pos++]|=128));this.pos++,p&&X(c,8)};function X(c,p){for(;p--;)c[p]=~c[p]}l.exports={abstractFunction:ne,addDeprecatedGetters:E,bufferFrom:$,capitalize:P,copyOwnProperties:ee,getHash:m,compare:Y,getOption:te,impliedNamespace:Q,isValidName:M,jsonEnd:q,newBuffer:R,objectValues:j,qualify:G,toMap:w,singleIndexOf:a,hasDuplicates:z,unqualify:D,BufferPool:S,Lcg:N,OrderedQueue:x,Tap:I}}}),ot=Ie({"node_modules/avsc/lib/types.js"(u,l){"use strict";var h=ze(),d=Ue,_=De,g=d.Buffer,O=d.SlowBuffer,T=h.Tap,v=_.debuglog("avsc:types"),R=_.format,$={array:X,boolean:z,bytes:q,double:D,enum:N,error:c,fixed:x,float:G,int:ee,long:M,map:I,null:j,record:c,string:Q},P=new h.Lcg,Y=new T(new O(1024)),te=null,m=[];function a(t,i){var e;if(te?(e=te,m.push([te,this]),te=null):e=this,this._hash=new Z,this.name=void 0,this.aliases=void 0,this.doc=t&&t.doc?""+t.doc:void 0,t){var r=t.name,n=t.namespace===void 0?i&&i.namespace:t.namespace;if(r!==void 0){if(r=ke(r,n),he(r))throw new Error(R("cannot rename primitive type: %j",r));var o=i&&i.registry;if(o){if(o[r]!==void 0)throw new Error(R("duplicate type name: %s",r));o[r]=e}}else if(i&&i.noAnonymousTypes)throw new Error(R("missing name property in schema: %j",t));this.name=r,this.aliases=t.aliases?t.aliases.map(function(s){return ke(s,n)}):[]}}a.forSchema=function(t,i){i=i||{},i.registry=i.registry||{};var e=function(k){switch(k===!0?k="always":k===!1?k="never":k===void 0?k="auto":typeof k=="string"&&(k=k.toLowerCase()),k){case"always":return S;case"never":return E;case"auto":return;default:throw new Error(R("invalid wrap unions option: %j",k))}}(i.wrapUnions);if(t===null)throw new Error('invalid type: null (did you mean "null"?)');if(a.isType(t))return t;var r;if(i.typeHook&&(r=i.typeHook(t,i))){if(!a.isType(r))throw new Error(R("invalid typehook return value: %j",r));return r}if(typeof t=="string"){if(t=ke(t,i.namespace),r=i.registry[t],r)return r;if(he(t))return i.registry[t]=a.forSchema({type:t},i);throw new Error(R("undefined type name: %s",t))}if(t.logicalType&&i.logicalTypes&&!te){var n=i.logicalTypes[t.logicalType];if(n){var o=i.namespace,s={};Object.keys(i.registry).forEach(function(k){s[k]=i.registry[k]});try{return v("instantiating logical type for %s",t.logicalType),new n(t,i)}catch(k){if(v("failed to instantiate logical type for %s",t.logicalType),i.assertLogicalTypes)throw k;te=null,i.namespace=o,i.registry=s}}}if(Array.isArray(t)){var f=te;te=null;var y=t.map(function(k){return a.forSchema(k,i)});e||(e=Te(y)?S:E),te=f,r=new e(y,i)}else r=function(k){var C=$[k];if(C===void 0)throw new Error(R("unknown type: %j",k));return new C(t,i)}(t.type);return r},a.forValue=function(t,i){if(i=i||{},i.emptyArrayType=i.emptyArrayType||a.forSchema({type:"array",items:"null"}),i.valueHook){var e=i.valueHook(t,i);if(e!==void 0){if(!a.isType(e))throw new Error(R("invalid value hook return value: %j",e));return e}}switch(typeof t){case"string":return a.forSchema("string",i);case"boolean":return a.forSchema("boolean",i);case"number":return(t|0)===t?a.forSchema("int",i):Math.abs(t)<9007199254740991?a.forSchema("float",i):a.forSchema("double",i);case"object":if(t===null)return a.forSchema("null",i);if(Array.isArray(t))return t.length?a.forSchema({type:"array",items:a.forTypes(t.map(function(n){return a.forValue(n,i)}),i)},i):i.emptyArrayType;if(g.isBuffer(t))return a.forSchema("bytes",i);var r=Object.keys(t);return r.some(function(n){return!h.isValidName(n)})?a.forSchema({type:"map",values:a.forTypes(r.map(function(n){return a.forValue(t[n],i)}),i)},i):a.forSchema({type:"record",fields:r.map(function(n){return{name:n,type:a.forValue(t[n],i)}})},i);default:throw new Error(R("cannot infer type from: %j",t))}},a.forTypes=function(t,i){if(!t.length)throw new Error("no types to combine");if(t.length===1)return t[0];i=i||{};var e=[],r=0,n=!0;if(t.forEach(function(L){switch(L.typeName){case"union:unwrapped":n=!1,e=e.concat(L.types);break;case"union:wrapped":r++,e=e.concat(L.types);break;case"null":e.push(L);break;default:n=!1,e.push(L)}}),r){if(!n)throw new Error("cannot combine wrapped union");var o={};e.forEach(function(L){var F=L.branchName,J=o[F];if(!J)o[F]=L;else if(!L.equals(J))throw new Error("inconsistent branch type")});var s=i.wrapUnions,f;i.wrapUnions=!0;try{f=a.forSchema(Object.keys(o).map(function(L){return o[L]}),i)}catch(L){throw i.wrapUnions=s,L}return i.wrapUnions=s,f}var y={};e.forEach(function(L){var F=$e(L),J=y[F];J||(y[F]=J=[]),J.push(L)});var k=Object.keys(y),C=k.map(function(L){var F=y[L];if(F.length===1)return F[0];switch(L){case"null":case"boolean":return F[0];case"number":return Fe(F);case"string":return Ge(F,i);case"buffer":return Ke(F,i);case"array":return F=F.filter(function(J){return J!==i.emptyArrayType}),F.length?a.forSchema({type:"array",items:a.forTypes(F.map(function(J){return J.itemsType}),i)},i):i.emptyArrayType;default:return Je(F,i)}});return C.length===1?C[0]:a.forSchema(C,i)},a.isType=function(){var t=arguments.length;if(!t)return!1;var i=arguments[0];if(!i||typeof i._update!="function"||typeof i.fingerprint!="function")return!1;if(t===1)return!0;var e=i.typeName,r;for(r=1;r<t;r++)if(e.indexOf(arguments[r])===0)return!0;return!1},a.__reset=function(t){v("resetting type buffer to %d",t),Y.buf=new O(t)},Object.defineProperty(a.prototype,"branchName",{enumerable:!0,get:function(){var t=a.isType(this,"logical")?this.underlyingType:this;return t.name?t.name:a.isType(t,"abstract")?t._concreteTypeName:a.isType(t,"union")?void 0:t.typeName}}),a.prototype.clone=function(t,i){return i?(i={coerce:!!i.coerceBuffers|0,fieldHook:i.fieldHook,qualifyNames:!!i.qualifyNames,skip:!!i.skipMissingFields,wrap:!!i.wrapUnions|0},this._copy(t,i)):this.fromBuffer(this.toBuffer(t))},a.prototype.compare=h.abstractFunction,a.prototype.compareBuffers=function(t,i){return this._match(new T(t),new T(i))},a.prototype.createResolver=function(t,i){if(!a.isType(t))throw new Error(R("not a type: %j",t));if(!a.isType(this,"union","logical")&&a.isType(t,"logical"))return this.createResolver(t.underlyingType,i);i=i||{},i.registry=i.registry||{};var e,r;if(a.isType(this,"record","error")&&a.isType(t,"record","error")&&(r=this.name+":"+t.name,e=i.registry[r],e))return e;if(e=new V(this),r&&(i.registry[r]=e),a.isType(t,"union")){var n=t.types.map(function(o){return this.createResolver(o,i)},this);e._read=function(o){var s=o.readLong(),f=n[s];if(f===void 0)throw new Error(R("invalid union index: %s",s));return n[s]._read(o)}}else this._update(e,t,i);if(!e._read)throw new Error(R("cannot read %s as %s",t,this));return Object.freeze(e)},a.prototype.decode=function(t,i,e){var r=new T(t,i),n=K(this,r,e);return r.isValid()?{value:n,offset:r.pos}:{value:void 0,offset:-1}},a.prototype.encode=function(t,i,e){var r=new T(i,e);return this._write(r,t),r.isValid()?r.pos:i.length-r.pos},a.prototype.equals=function(t,i){var e=a.isType(t)&&this.fingerprint().equals(t.fingerprint());return!e||!(i&&i.strict)?e:JSON.stringify(this.schema({exportAttrs:!0}))===JSON.stringify(t.schema({exportAttrs:!0}))},a.prototype.fingerprint=function(t){if(t)return h.getHash(JSON.stringify(this.schema()),t);if(!this._hash.str){var i=JSON.stringify(this.schema());this._hash.str=h.getHash(i).toString("binary")}return h.bufferFrom(this._hash.str,"binary")},a.prototype.fromBuffer=function(t,i,e){var r=new T(t),n=K(this,r,i,e);if(!r.isValid())throw new Error("truncated buffer");if(!e&&r.pos<t.length)throw new Error("trailing data");return n},a.prototype.fromString=function(t){return this._copy(JSON.parse(t),{coerce:2})},a.prototype.inspect=function(){var t=this.typeName,i=ge(t);if(he(t))return R("<%s>",i);var e=this.schema({exportAttrs:!0,noDeref:!0});return typeof e=="object"&&!a.isType(this,"logical")&&(e.type=void 0),R("<%s %j>",i,e)},a.prototype.isValid=function(t,i){var e=(i&&i.noUndeclaredFields)|0,r=i&&i.errorHook,n,o;return r&&(o=[],n=function(s,f){r.call(this,o.slice(),s,f,t)}),this._check(t,e,n,o)},a.prototype.random=h.abstractFunction,a.prototype.schema=function(t){return this._attrs({exportAttrs:!!(t&&t.exportAttrs),noDeref:!!(t&&t.noDeref)})},a.prototype.toBuffer=function(t){Y.pos=0,this._write(Y,t);var i=h.newBuffer(Y.pos);return Y.isValid()?Y.buf.copy(i,0,0,Y.pos):this._write(new T(i),t),i},a.prototype.toJSON=function(){return this.schema({exportAttrs:!0})},a.prototype.toString=function(t){return JSON.stringify(t===void 0?this.schema({noDeref:!0}):this._copy(t,{coerce:3}))},a.prototype.wrap=function(t){var i=this._branchConstructor;return i===null?null:new i(t)},a.prototype._attrs=function(t){t.derefed=t.derefed||{};var i=this.name;if(i!==void 0){if(t.noDeref||t.derefed[i])return i;t.derefed[i]=!0}var e={};this.name!==void 0&&(e.name=i),e.type=this.typeName;var r=this._deref(e,t);return r!==void 0&&(e=r),t.exportAttrs&&(this.aliases&&this.aliases.length&&(e.aliases=this.aliases),this.doc!==void 0&&(e.doc=this.doc)),e},a.prototype._createBranchConstructor=function(){var t=this.branchName;if(t==="null")return null;var i=~t.indexOf(".")?"this['"+t+"']":"this."+t,e="return function Branch$(val) { "+i+" = val; };",r=new Function(e)();return r.type=this,r.prototype.unwrap=new Function("return "+i+";"),r.prototype.unwrapped=r.prototype.unwrap,r},a.prototype._peek=function(t){var i=t.pos,e=this._read(t);return t.pos=i,e},a.prototype._check=h.abstractFunction,a.prototype._copy=h.abstractFunction,a.prototype._deref=h.abstractFunction,a.prototype._match=h.abstractFunction,a.prototype._read=h.abstractFunction,a.prototype._skip=h.abstractFunction,a.prototype._update=h.abstractFunction,a.prototype._write=h.abstractFunction,a.prototype.getAliases=function(){return this.aliases},a.prototype.getFingerprint=a.prototype.fingerprint,a.prototype.getName=function(t){return this.name||!t?this.name:this.branchName},a.prototype.getSchema=a.prototype.schema,a.prototype.getTypeName=function(){return this.typeName};function w(t){a.call(this),this._branchConstructor=this._createBranchConstructor(),t||Object.freeze(this)}_.inherits(w,a),w.prototype._update=function(t,i){i.typeName===this.typeName&&(t._read=this._read)},w.prototype._copy=function(t){return this._check(t,void 0,ae),t},w.prototype._deref=function(){return this.typeName},w.prototype.compare=h.compare;function j(){w.call(this)}_.inherits(j,w),j.prototype._check=function(t,i,e){var r=t===null;return!r&&e&&e(t,this),r},j.prototype._read=function(){return null},j.prototype._skip=function(){},j.prototype._write=function(t,i){i!==null&&ae(i,this)},j.prototype._match=function(){return 0},j.prototype.compare=j.prototype._match,j.prototype.typeName="null",j.prototype.random=j.prototype._read;function z(){w.call(this)}_.inherits(z,w),z.prototype._check=function(t,i,e){var r=typeof t=="boolean";return!r&&e&&e(t,this),r},z.prototype._read=function(t){return t.readBoolean()},z.prototype._skip=function(t){t.skipBoolean()},z.prototype._write=function(t,i){typeof i!="boolean"&&ae(i,this),t.writeBoolean(i)},z.prototype._match=function(t,i){return t.matchBoolean(i)},z.prototype.typeName="boolean",z.prototype.random=function(){return P.nextBoolean()};function ee(){w.call(this)}_.inherits(ee,w),ee.prototype._check=function(t,i,e){var r=t===(t|0);return!r&&e&&e(t,this),r},ee.prototype._read=function(t){return t.readInt()},ee.prototype._skip=function(t){t.skipInt()},ee.prototype._write=function(t,i){i!==(i|0)&&ae(i,this),t.writeInt(i)},ee.prototype._match=function(t,i){return t.matchInt(i)},ee.prototype.typeName="int",ee.prototype.random=function(){return P.nextInt(1e3)|0};function M(){w.call(this)}_.inherits(M,w),M.prototype._check=function(t,i,e){var r=typeof t=="number"&&t%1===0&&Ce(t);return!r&&e&&e(t,this),r},M.prototype._read=function(t){var i=t.readLong();if(!Ce(i))throw new Error("potential precision loss");return i},M.prototype._skip=function(t){t.skipLong()},M.prototype._write=function(t,i){(typeof i!="number"||i%1||!Ce(i))&&ae(i,this),t.writeLong(i)},M.prototype._match=function(t,i){return t.matchLong(i)},M.prototype._update=function(t,i){switch(i.typeName){case"int":t._read=i._read;break;case"abstract:long":case"long":t._read=this._read}},M.prototype.typeName="long",M.prototype.random=function(){return P.nextInt()},M.__with=function(t,i){t=t||{};var e={toBuffer:"_toBuffer",fromBuffer:"_fromBuffer",fromJSON:"_fromJSON",toJSON:"_toJSON",isValid:"_isValid",compare:"compare"},r=new b(i);return Object.keys(e).forEach(function(n){if(t[n]===void 0)throw new Error(R("missing method implementation: %s",n));r[e[n]]=t[n]}),Object.freeze(r)};function G(){w.call(this)}_.inherits(G,w),G.prototype._check=function(t,i,e){var r=typeof t=="number";return!r&&e&&e(t,this),r},G.prototype._read=function(t){return t.readFloat()},G.prototype._skip=function(t){t.skipFloat()},G.prototype._write=function(t,i){typeof i!="number"&&ae(i,this),t.writeFloat(i)},G.prototype._match=function(t,i){return t.matchFloat(i)},G.prototype._update=function(t,i){switch(i.typeName){case"float":case"int":t._read=i._read;break;case"abstract:long":case"long":t._read=function(e){return e.readLong()}}},G.prototype.typeName="float",G.prototype.random=function(){return P.nextFloat(1e3)};function D(){w.call(this)}_.inherits(D,w),D.prototype._check=function(t,i,e){var r=typeof t=="number";return!r&&e&&e(t,this),r},D.prototype._read=function(t){return t.readDouble()},D.prototype._skip=function(t){t.skipDouble()},D.prototype._write=function(t,i){typeof i!="number"&&ae(i,this),t.writeDouble(i)},D.prototype._match=function(t,i){return t.matchDouble(i)},D.prototype._update=function(t,i){switch(i.typeName){case"double":case"float":case"int":t._read=i._read;break;case"abstract:long":case"long":t._read=function(e){return e.readLong()}}},D.prototype.typeName="double",D.prototype.random=function(){return P.nextFloat()};function Q(){w.call(this)}_.inherits(Q,w),Q.prototype._check=function(t,i,e){var r=typeof t=="string";return!r&&e&&e(t,this),r},Q.prototype._read=function(t){return t.readString()},Q.prototype._skip=function(t){t.skipString()},Q.prototype._write=function(t,i){typeof i!="string"&&ae(i,this),t.writeString(i)},Q.prototype._match=function(t,i){return t.matchString(i)},Q.prototype._update=function(t,i){switch(i.typeName){case"bytes":case"string":t._read=this._read}},Q.prototype.typeName="string",Q.prototype.random=function(){return P.nextString(P.nextInt(32))};function q(){w.call(this)}_.inherits(q,w),q.prototype._check=function(t,i,e){var r=g.isBuffer(t);return!r&&e&&e(t,this),r},q.prototype._read=function(t){return t.readBytes()},q.prototype._skip=function(t){t.skipBytes()},q.prototype._write=function(t,i){g.isBuffer(i)||ae(i,this),t.writeBytes(i)},q.prototype._match=function(t,i){return t.matchBytes(i)},q.prototype._update=Q.prototype._update,q.prototype._copy=function(t,i){var e;switch((i&&i.coerce)|0){case 3:return this._check(t,void 0,ae),t.toString("binary");case 2:if(typeof t!="string")throw new Error(R("cannot coerce to buffer: %j",t));return e=h.bufferFrom(t,"binary"),this._check(e,void 0,ae),e;case 1:if(!je(t))throw new Error(R("cannot coerce to buffer: %j",t));return e=h.bufferFrom(t.data),this._check(e,void 0,ae),e;default:return this._check(t,void 0,ae),h.bufferFrom(t)}},q.prototype.compare=g.compare,q.prototype.typeName="bytes",q.prototype.random=function(){return P.nextBuffer(P.nextInt(32))};function ne(t,i){if(a.call(this),!Array.isArray(t))throw new Error(R("non-array union schema: %j",t));if(!t.length)throw new Error("empty union");this.types=Object.freeze(t.map(function(e){return a.forSchema(e,i)})),this._branchIndices={},this.types.forEach(function(e,r){if(a.isType(e,"union"))throw new Error("unions cannot be directly nested");var n=e.branchName;if(this._branchIndices[n]!==void 0)throw new Error(R("duplicate union branch name: %j",n));this._branchIndices[n]=r},this)}_.inherits(ne,a),ne.prototype._branchConstructor=function(){throw new Error("unions cannot be directly wrapped")},ne.prototype._skip=function(t){this.types[t.readLong()]._skip(t)},ne.prototype._match=function(t,i){var e=t.readLong(),r=i.readLong();return e===r?this.types[e]._match(t,i):e<r?-1:1},ne.prototype._deref=function(t,i){return this.types.map(function(e){return e._attrs(i)})},ne.prototype.getTypes=function(){return this.types};function E(t,i){ne.call(this,t,i),this._dynamicBranches=null,this._bucketIndices={},this.types.forEach(function(e,r){if(a.isType(e,"abstract","logical"))this._dynamicBranches||(this._dynamicBranches=[]),this._dynamicBranches.push({index:r,type:e});else{var n=$e(e);if(this._bucketIndices[n]!==void 0)throw new Error(R("ambiguous unwrapped union: %j",this));this._bucketIndices[n]=r}},this),Object.freeze(this)}_.inherits(E,ne),E.prototype._getIndex=function(t){var i=this._bucketIndices[xe(t)];return this._dynamicBranches&&(i=this._getBranchIndex(t,i)),i},E.prototype._getBranchIndex=function(t,i){var e=this._dynamicBranches,r,n,o;for(r=0,n=e.length;r<n;r++)if(o=e[r],o.type._check(t))if(i===void 0)i=o.index;else throw new Error("ambiguous conversion");return i},E.prototype._check=function(t,i,e,r){var n=this._getIndex(t),o=n!==void 0;return o?this.types[n]._check(t,i,e,r):(e&&e(t,this),o)},E.prototype._read=function(t){var i=t.readLong(),e=this.types[i];if(e)return e._read(t);throw new Error(R("invalid union index: %s",i))},E.prototype._write=function(t,i){var e=this._getIndex(i);e===void 0&&ae(i,this),t.writeLong(e),i!==null&&this.types[e]._write(t,i)},E.prototype._update=function(t,i,e){var r,n,o;for(r=0,n=this.types.length;r<n;r++){try{o=this.types[r].createResolver(i,e)}catch{continue}t._read=function(s){return o._read(s)};return}},E.prototype._copy=function(t,i){var e=i&&i.coerce|0,r=i&&i.wrap|0,n;if(r===2)n=0;else{switch(e){case 1:je(t)&&this._bucketIndices.buffer!==void 0?n=this._bucketIndices.buffer:n=this._getIndex(t);break;case 2:if(t===null)n=this._bucketIndices.null;else if(typeof t=="object"){var o=Object.keys(t);o.length===1&&(n=this._branchIndices[o[0]],t=t[o[0]])}break;default:n=this._getIndex(t)}n===void 0&&ae(t,this)}var s=this.types[n];if(t===null||r===3)return s._copy(t,i);switch(e){case 3:var f={};return f[s.branchName]=s._copy(t,i),f;default:return s._copy(t,i)}},E.prototype.compare=function(t,i){var e=this._getIndex(t),r=this._getIndex(i);if(e===void 0)ae(t,this);else if(r===void 0)ae(i,this);else return e===r?this.types[e].compare(t,i):h.compare(e,r)},E.prototype.typeName="union:unwrapped",E.prototype.random=function(){var t=P.nextInt(this.types.length);return this.types[t].random()};function S(t,i){ne.call(this,t,i),Object.freeze(this)}_.inherits(S,ne),S.prototype._check=function(t,i,e,r){var n=!1;if(t===null)n=this._branchIndices.null!==void 0;else if(typeof t=="object"){var o=Object.keys(t);if(o.length===1){var s=o[0],f=this._branchIndices[s];if(f!==void 0)return e?(r.push(s),n=this.types[f]._check(t[s],i,e,r),r.pop(),n):this.types[f]._check(t[s],i)}}return!n&&e&&e(t,this),n},S.prototype._read=function(t){var i=this.types[t.readLong()];if(!i)throw new Error(R("invalid union index"));var e=i._branchConstructor;return e===null?null:new e(i._read(t))},S.prototype._write=function(t,i){var e,r,n;i===null?(e=this._branchIndices.null,e===void 0&&ae(i,this),t.writeLong(e)):(r=Object.keys(i),r.length===1&&(n=r[0],e=this._branchIndices[n]),e===void 0&&ae(i,this),t.writeLong(e),this.types[e]._write(t,i[n]))},S.prototype._update=function(t,i,e){var r,n,o,s;for(r=0,n=this.types.length;r<n;r++){try{o=this.types[r].createResolver(i,e)}catch{continue}s=this.types[r]._branchConstructor,s?t._read=function(f){return new s(o._read(f))}:t._read=function(){return null};return}},S.prototype._copy=function(t,i){var e=i&&i.wrap|0;if(e===2){var r=this.types[0];return t===null&&r.typeName==="null"?null:new r._branchConstructor(r._copy(t,i))}if(t===null&&this._branchIndices.null!==void 0)return null;var n,o,s;if(typeof t=="object"){var f=Object.keys(t);if(f.length===1){var y=f[0];if(n=this._branchIndices[y],n===void 0&&i.qualifyNames){var k,C;for(k=0,o=this.types.length;k<o;k++)if(C=this.types[k],C.name&&y===h.unqualify(C.name)){n=k;break}}n!==void 0&&(s=this.types[n]._copy(t[y],i))}}if(e===1&&s===void 0)for(n=0,o=this.types.length;n<o&&s===void 0;)try{s=this.types[n]._copy(t,i)}catch{n++}if(s!==void 0)return e===3?s:new this.types[n]._branchConstructor(s);ae(t,this)},S.prototype.compare=function(t,i){var e=t===null?"null":Object.keys(t)[0],r=i===null?"null":Object.keys(i)[0],n=this._branchIndices[e];return e===r?e==="null"?0:this.types[n].compare(t[e],i[e]):h.compare(n,this._branchIndices[r])},S.prototype.typeName="union:wrapped",S.prototype.random=function(){var t=P.nextInt(this.types.length),i=this.types[t],e=i._branchConstructor;return e?new e(i.random()):null};function N(t,i){if(a.call(this,t,i),!Array.isArray(t.symbols)||!t.symbols.length)throw new Error(R("invalid enum symbols: %j",t.symbols));if(this.symbols=Object.freeze(t.symbols.slice()),this._indices={},this.symbols.forEach(function(e,r){if(!h.isValidName(e))throw new Error(R("invalid %s symbol: %j",this,e));if(this._indices[e]!==void 0)throw new Error(R("duplicate %s symbol: %j",this,e));this._indices[e]=r},this),this.default=t.default,this.default!==void 0&&this._indices[this.default]===void 0)throw new Error(R("invalid %s default: %j",this,this.default));this._branchConstructor=this._createBranchConstructor(),Object.freeze(this)}_.inherits(N,a),N.prototype._check=function(t,i,e){var r=this._indices[t]!==void 0;return!r&&e&&e(t,this),r},N.prototype._read=function(t){var i=t.readLong(),e=this.symbols[i];if(e===void 0)throw new Error(R("invalid %s enum index: %s",this.name,i));return e},N.prototype._skip=function(t){t.skipLong()},N.prototype._write=function(t,i){var e=this._indices[i];e===void 0&&ae(i,this),t.writeLong(e)},N.prototype._match=function(t,i){return t.matchLong(i)},N.prototype.compare=function(t,i){return h.compare(this._indices[t],this._indices[i])},N.prototype._update=function(t,i,e){var r=this.symbols;i.typeName==="enum"&&pe(this,i,!e.ignoreNamespaces)&&(i.symbols.every(function(n){return~r.indexOf(n)})||this.default!==void 0)&&(t.symbols=i.symbols.map(function(n){return this._indices[n]===void 0?this.default:n},this),t._read=i._read)},N.prototype._copy=function(t){return this._check(t,void 0,ae),t},N.prototype._deref=function(t){t.symbols=this.symbols},N.prototype.getSymbols=function(){return this.symbols},N.prototype.typeName="enum",N.prototype.random=function(){return P.choice(this.symbols)};function x(t,i){if(a.call(this,t,i),t.size!==(t.size|0)||t.size<0)throw new Error(R("invalid %s size",this.branchName));this.size=t.size|0,this._branchConstructor=this._createBranchConstructor(),Object.freeze(this)}_.inherits(x,a),x.prototype._check=function(t,i,e){var r=g.isBuffer(t)&&t.length===this.size;return!r&&e&&e(t,this),r},x.prototype._read=function(t){return t.readFixed(this.size)},x.prototype._skip=function(t){t.skipFixed(this.size)},x.prototype._write=function(t,i){(!g.isBuffer(i)||i.length!==this.size)&&ae(i,this),t.writeFixed(i,this.size)},x.prototype._match=function(t,i){return t.matchFixed(i,this.size)},x.prototype.compare=g.compare,x.prototype._update=function(t,i,e){i.typeName==="fixed"&&this.size===i.size&&pe(this,i,!e.ignoreNamespaces)&&(t.size=this.size,t._read=this._read)},x.prototype._copy=q.prototype._copy,x.prototype._deref=function(t){t.size=this.size},x.prototype.getSize=function(){return this.size},x.prototype.typeName="fixed",x.prototype.random=function(){return P.nextBuffer(this.size)};function I(t,i){if(a.call(this),!t.values)throw new Error(R("missing map values: %j",t));this.valuesType=a.forSchema(t.values,i),this._branchConstructor=this._createBranchConstructor(),Object.freeze(this)}_.inherits(I,a),I.prototype._check=function(t,i,e,r){if(!t||typeof t!="object"||Array.isArray(t))return e&&e(t,this),!1;var n=Object.keys(t),o=!0,s,f,y,k;if(e){for(y=r.length,r.push(""),s=0,f=n.length;s<f;s++)k=r[y]=n[s],this.valuesType._check(t[k],i,e,r)||(o=!1);r.pop()}else for(s=0,f=n.length;s<f;s++)if(!this.valuesType._check(t[n[s]],i))return!1;return o},I.prototype._read=function(t){for(var i=this.valuesType,e={},r;r=ve(t);)for(;r--;){var n=t.readString();e[n]=i._read(t)}return e},I.prototype._skip=function(t){for(var i=this.valuesType,e,r;r=t.readLong();)if(r<0)e=t.readLong(),t.pos+=e;else for(;r--;)t.skipString(),i._skip(t)},I.prototype._write=function(t,i){(!i||typeof i!="object"||Array.isArray(i))&&ae(i,this);var e=this.valuesType,r=Object.keys(i),n=r.length,o,s;if(n)for(t.writeLong(n),o=0;o<n;o++)s=r[o],t.writeString(s),e._write(t,i[s]);t.writeLong(0)},I.prototype._match=function(){throw new Error("maps cannot be compared")},I.prototype._update=function(t,i,e){i.typeName==="map"&&(t.valuesType=this.valuesType.createResolver(i.valuesType,e),t._read=this._read)},I.prototype._copy=function(t,i){if(t&&typeof t=="object"&&!Array.isArray(t)){var e=this.valuesType,r=Object.keys(t),n,o,s,f={};for(n=0,o=r.length;n<o;n++)s=r[n],f[s]=e._copy(t[s],i);return f}ae(t,this)},I.prototype.compare=I.prototype._match,I.prototype.typeName="map",I.prototype.getValuesType=function(){return this.valuesType},I.prototype.random=function(){var t={},i,e;for(i=0,e=P.nextInt(10);i<e;i++)t[P.nextString(P.nextInt(20))]=this.valuesType.random();return t},I.prototype._deref=function(t,i){t.values=this.valuesType._attrs(i)};function X(t,i){if(a.call(this),!t.items)throw new Error(R("missing array items: %j",t));this.itemsType=a.forSchema(t.items,i),this._branchConstructor=this._createBranchConstructor(),Object.freeze(this)}_.inherits(X,a),X.prototype._check=function(t,i,e,r){if(!Array.isArray(t))return e&&e(t,this),!1;var n=this.itemsType,o=!0,s,f,y;if(e){for(y=r.length,r.push(""),s=0,f=t.length;s<f;s++)r[y]=""+s,n._check(t[s],i,e,r)||(o=!1);r.pop()}else for(s=0,f=t.length;s<f;s++)if(!n._check(t[s],i))return!1;return o},X.prototype._read=function(t){for(var i=this.itemsType,e=0,r,n;n=t.readLong();)for(n<0&&(n=-n,t.skipLong()),r=r||new Array(n);n--;)r[e++]=i._read(t);return r||[]},X.prototype._skip=function(t){for(var i=this.itemsType,e,r;r=t.readLong();)if(r<0)e=t.readLong(),t.pos+=e;else for(;r--;)i._skip(t)},X.prototype._write=function(t,i){Array.isArray(i)||ae(i,this);var e=this.itemsType,r=i.length,n;if(r)for(t.writeLong(r),n=0;n<r;n++)e._write(t,i[n]);t.writeLong(0)},X.prototype._match=function(t,i){for(var e=t.readLong(),r=i.readLong(),n;e&&r;){if(n=this.itemsType._match(t,i),n)return n;--e||(e=ve(t)),--r||(r=ve(i))}return h.compare(e,r)},X.prototype._update=function(t,i,e){i.typeName==="array"&&(t.itemsType=this.itemsType.createResolver(i.itemsType,e),t._read=this._read)},X.prototype._copy=function(t,i){Array.isArray(t)||ae(t,this);var e=new Array(t.length),r,n;for(r=0,n=t.length;r<n;r++)e[r]=this.itemsType._copy(t[r],i);return e},X.prototype._deref=function(t,i){t.items=this.itemsType._attrs(i)},X.prototype.compare=function(t,i){var e=t.length,r=i.length,n,o,s;for(n=0,o=Math.min(e,r);n<o;n++)if(s=this.itemsType.compare(t[n],i[n]))return s;return h.compare(e,r)},X.prototype.getItemsType=function(){return this.itemsType},X.prototype.typeName="array",X.prototype.random=function(){var t=[],i,e;for(i=0,e=P.nextInt(10);i<e;i++)t.push(this.itemsType.random());return t};function c(t,i){i=i||{};var e=i.namespace;if(t.namespace!==void 0)i.namespace=t.namespace;else if(t.name){var r=h.impliedNamespace(t.name);r!==void 0&&(i.namespace=r)}if(a.call(this,t,i),!Array.isArray(t.fields))throw new Error(R("non-array record fields: %j",t.fields));if(h.hasDuplicates(t.fields,function(n){return n.name}))throw new Error(R("duplicate field name: %j",t.fields));this._fieldsByName={},this.fields=Object.freeze(t.fields.map(function(n){var o=new A(n,i);return this._fieldsByName[o.name]=o,o},this)),this._branchConstructor=this._createBranchConstructor(),this._isError=t.type==="error",this.recordConstructor=this._createConstructor(i.errorStackTraces,i.omitRecordMethods),this._read=this._createReader(),this._skip=this._createSkipper(),this._write=this._createWriter(),this._check=this._createChecker(),i.namespace=e,Object.freeze(this)}_.inherits(c,a),c.prototype._getConstructorName=function(){return this.name?h.capitalize(h.unqualify(this.name)):this._isError?"Error$":"Record$"},c.prototype._createConstructor=function(t,i){var e=[],r=[],n=[],o="",s,f,y,k,C,L,F;for(s=0,f=this.fields.length;s<f;s++)y=this.fields[s],C=y.defaultValue,L=C()!==void 0,k=y.name,t&&this._isError&&k==="stack"&&a.isType(y.type,"string")&&!L&&(F=y),r.push("v"+s),o+="  ",L?(o+="if (v"+s+" === undefined) { ",o+="this."+k+" = d"+n.length+"(); ",o+="} else { this."+k+" = v"+s+`; }
`,e.push("d"+n.length),n.push(C)):o+="this."+k+" = v"+s+`;
`;F&&(o+="  if (this.stack === undefined) { ",typeof Error.captureStackTrace=="function"?o+="Error.captureStackTrace(this, this.constructor);":o+="this.stack = Error().stack;",o+=` }
`);var J="return function "+this._getConstructorName()+"(";J+=r.join()+`) {
`+o+"};";var B=new Function(e.join(),J).apply(void 0,n);if(i)return B;var H=this;return B.getType=function(){return H},B.type=H,this._isError&&(_.inherits(B,Error),B.prototype.name=this._getConstructorName()),B.prototype.clone=function(W){return H.clone(this,W)},B.prototype.compare=function(W){return H.compare(this,W)},B.prototype.isValid=function(W){return H.isValid(this,W)},B.prototype.toBuffer=function(){return H.toBuffer(this)},B.prototype.toString=function(){return H.toString(this)},B.prototype.wrap=function(){return H.wrap(this)},B.prototype.wrapped=B.prototype.wrap,B},c.prototype._createChecker=function(){var t=[],i=[],e=this._getConstructorName(),r="return function check"+e+`(v, f, h, p) {
`;if(r+=`  if (
`,r+=`    v === null ||
`,r+=`    typeof v != 'object' ||
`,r+=`    (f && !this._checkFields(v))
`,r+=`  ) {
`,r+=`    if (h) { h(v, this); }
`,r+=`    return false;
`,r+=`  }
`,!this.fields.length)r+=`  return true;
`;else{for(n=0,o=this.fields.length;n<o;n++)s=this.fields[n],t.push("t"+n),i.push(s.type),s.defaultValue()!==void 0&&(r+="  var v"+n+" = v."+s.name+`;
`);r+=`  if (h) {
`,r+=`    var b = 1;
`,r+=`    var j = p.length;
`,r+=`    p.push('');
`;var n,o,s;for(n=0,o=this.fields.length;n<o;n++)s=this.fields[n],r+="    p[j] = '"+s.name+`';
`,r+="    b &= ",s.defaultValue()===void 0?r+="t"+n+"._check(v."+s.name+`, f, h, p);
`:(r+="v"+n+" === undefined || ",r+="t"+n+"._check(v"+n+`, f, h, p);
`);r+=`    p.pop();
`,r+=`    return !!b;
`,r+=`  } else {
    return (
      `,r+=this.fields.map(function(f,y){return f.defaultValue()===void 0?"t"+y+"._check(v."+f.name+", f)":"(v"+y+" === undefined || t"+y+"._check(v"+y+", f))"}).join(` &&
      `),r+=`
    );
  }
`}return r+="};",new Function(t.join(),r).apply(void 0,i)},c.prototype._createReader=function(){var t=[],i=[this.recordConstructor],e,r;for(e=0,r=this.fields.length;e<r;e++)t.push("t"+e),i.push(this.fields[e].type);var n=this._getConstructorName(),o="return function read"+n+`(t) {
`;return o+="  return new "+n+`(
    `,o+=t.map(function(s){return s+"._read(t)"}).join(`,
    `),o+=`
  );
};`,t.unshift(n),new Function(t.join(),o).apply(void 0,i)},c.prototype._createSkipper=function(){var t=[],i="return function skip"+this._getConstructorName()+`(t) {
`,e=[],r,n;for(r=0,n=this.fields.length;r<n;r++)t.push("t"+r),e.push(this.fields[r].type),i+="  t"+r+`._skip(t);
`;return i+="}",new Function(t.join(),i).apply(void 0,e)},c.prototype._createWriter=function(){var t=[],i=this._getConstructorName(),e="return function write"+i+`(t, v) {
`,r=[],n,o,s,f;for(n=0,o=this.fields.length;n<o;n++)s=this.fields[n],t.push("t"+n),r.push(s.type),e+="  ",s.defaultValue()===void 0?e+="t"+n+"._write(t, v."+s.name+`);
`:(f=s.type.toBuffer(s.defaultValue()).toString("binary"),t.push("d"+n),r.push(f),e+="var v"+n+" = v."+s.name+`;
`,e+="if (v"+n+` === undefined) {
`,e+="    t.writeBinary(d"+n+", "+f.length+`);
`,e+=`  } else {
    t`+n+"._write(t, v"+n+`);
  }
`);return e+="}",new Function(t.join(),e).apply(void 0,r)},c.prototype._update=function(t,i,e){if(!pe(this,i,!e.ignoreNamespaces))throw new Error(R("no alias found for %s",i.name));var r=this.fields,n=i.fields,o=h.toMap(n,function(we){return we.name}),s=[],f={},y,k,C,L,F,J,B;for(y=0;y<r.length;y++){for(C=r[y],F=ce(C),J=[],k=0;k<F.length;k++)L=F[k],o[L]&&J.push(L);if(J.length>1)throw new Error(R("ambiguous aliasing for %s.%s (%s)",i.name,C.name,J));if(J.length)L=J[0],B={resolver:C.type.createResolver(o[L].type,e),name:"_"+C.name},f[L]?f[L].push(B):f[L]=[B],s.push(B.name);else{if(C.defaultValue()===void 0)throw new Error(R("no matching field for default-less %s.%s",i.name,C.name));s.push("undefined")}}var H=-1;for(y=n.length;y&&f[n[--y].name]===void 0;)H=y;var W=this._getConstructorName(),ie=[W],se=[this.recordConstructor],ue="  return function read"+W+`(t, b) {
`;for(y=0;y<n.length;y++)if(y===H&&(ue+=`  if (!b) {
`),C=i.fields[y],L=C.name,f[L]===void 0)ue+=~H&&y>=H?"    ":"  ",ie.push("r"+y),se.push(C.type),ue+="r"+y+`._skip(t);
`;else for(k=f[L].length;k--;)ue+=~H&&y>=H?"    ":"  ",ie.push("r"+y+"f"+k),B=f[L][k],se.push(B.resolver),ue+="var "+B.name+" = ",ue+="r"+y+"f"+k+"._"+(k?"peek":"read")+`(t);
`;~H&&(ue+=`  }
`),ue+="  return new "+W+"("+s.join()+`);
};`,t._read=new Function(ie.join(),ue).apply(void 0,se)},c.prototype._match=function(t,i){var e=this.fields,r,n,o,s,f;for(r=0,n=e.length;r<n;r++)if(o=e[r],s=o._order,f=o.type,s){if(s*=f._match(t,i),s)return s}else f._skip(t),f._skip(i);return 0},c.prototype._checkFields=function(t){var i=Object.keys(t),e,r;for(e=0,r=i.length;e<r;e++)if(!this._fieldsByName[i[e]])return!1;return!0},c.prototype._copy=function(t,i){var e=i&&i.fieldHook,r=[void 0],n,o,s,f;for(n=0,o=this.fields.length;n<o;n++)s=this.fields[n],f=t[s.name],f===void 0&&s.hasOwnProperty("defaultValue")&&(f=s.defaultValue()),(i&&!i.skip||f!==void 0)&&(f=s.type._copy(f,i)),e&&(f=e(s,f,this)),r.push(f);var y=this.recordConstructor;return new(y.bind.apply(y,r))},c.prototype._deref=function(t,i){t.fields=this.fields.map(function(e){var r=e.type,n={name:e.name,type:r._attrs(i)};if(i.exportAttrs){var o=e.defaultValue();o!==void 0&&(n.default=r._copy(o,{coerce:3,wrap:3}));var s=e.order;s!=="ascending"&&(n.order=s);var f=e.aliases;f.length&&(n.aliases=f);var y=e.doc;y!==void 0&&(n.doc=y)}return n})},c.prototype.compare=function(t,i){var e=this.fields,r,n,o,s,f,y;for(r=0,n=e.length;r<n;r++)if(o=e[r],s=o.name,f=o._order,y=o.type,f&&(f*=y.compare(t[s],i[s]),f))return f;return 0},c.prototype.random=function(){var t=this.fields.map(function(e){return e.type.random()});t.unshift(void 0);var i=this.recordConstructor;return new(i.bind.apply(i,t))},c.prototype.field=function(t){return this._fieldsByName[t]},c.prototype.getField=c.prototype.field,c.prototype.getFields=function(){return this.fields},c.prototype.getRecordConstructor=function(){return this.recordConstructor},Object.defineProperty(c.prototype,"typeName",{enumerable:!0,get:function(){return this._isError?"error":"record"}});function p(t,i){this._logicalTypeName=t.logicalType,a.call(this),te=this;try{this._underlyingType=a.forSchema(t,i)}finally{te=null;var e=m.length;e&&m[e-1][0]===this&&m.pop()}a.isType(this.underlyingType,"union")?this._branchConstructor=this.underlyingType._branchConstructor:this._branchConstructor=this.underlyingType._createBranchConstructor()}_.inherits(p,a),Object.defineProperty(p.prototype,"typeName",{enumerable:!0,get:function(){return"logical:"+this._logicalTypeName}}),Object.defineProperty(p.prototype,"underlyingType",{enumerable:!0,get:function(){if(this._underlyingType)return this._underlyingType;var t,i,e;for(t=0,i=m.length;t<i;t++)if(e=m[t],e[0]===this)return e[1]}}),p.prototype.getUnderlyingType=function(){return this.underlyingType},p.prototype._read=function(t){return this._fromValue(this.underlyingType._read(t))},p.prototype._write=function(t,i){this.underlyingType._write(t,this._toValue(i))},p.prototype._check=function(t,i,e,r){try{var n=this._toValue(t)}catch{}return n===void 0?(e&&e(t,this),!1):this.underlyingType._check(n,i,e,r)},p.prototype._copy=function(t,i){var e=this.underlyingType;switch(i&&i.coerce){case 3:return e._copy(this._toValue(t),i);case 2:return this._fromValue(e._copy(t,i));default:return this._fromValue(e._copy(this._toValue(t),i))}},p.prototype._update=function(t,i,e){var r=this._resolve(i,e);r&&(t._read=function(n){return r(i._read(n))})},p.prototype.compare=function(t,i){var e=this._toValue(t),r=this._toValue(i);return this.underlyingType.compare(e,r)},p.prototype.random=function(){return this._fromValue(this.underlyingType.random())},p.prototype._deref=function(t,i){var e=this.underlyingType,r=e.name!==void 0&&i.derefed[e.name];return t=e._attrs(i),!r&&i.exportAttrs&&(typeof t=="string"&&(t={type:t}),t.logicalType=this._logicalTypeName,this._export(t)),t},p.prototype._skip=function(t){this.underlyingType._skip(t)},p.prototype._export=function(){},p.prototype._fromValue=h.abstractFunction,p.prototype._toValue=h.abstractFunction,p.prototype._resolve=h.abstractFunction;function b(t){this._concreteTypeName="long",w.call(this,!0),this._noUnpack=!!t}_.inherits(b,M),b.prototype.typeName="abstract:long",b.prototype._check=function(t,i,e){var r=this._isValid(t);return!r&&e&&e(t,this),r},b.prototype._read=function(t){var i,e;if(this._noUnpack?(e=t.pos,t.skipLong(),i=t.buf.slice(e,t.pos)):i=t.unpackLongBytes(t),t.isValid())return this._fromBuffer(i)},b.prototype._write=function(t,i){this._isValid(i)||ae(i,this);var e=this._toBuffer(i);this._noUnpack?t.writeFixed(e):t.packLongBytes(e)},b.prototype._copy=function(t,i){switch(i&&i.coerce){case 3:return this._toJSON(t);case 2:return this._fromJSON(t);default:return this._fromJSON(this._toJSON(t))}},b.prototype._deref=function(){return"long"},b.prototype._update=function(t,i){var e=this;switch(i.typeName){case"int":t._read=function(r){return e._fromJSON(i._read(r))};break;case"abstract:long":case"long":t._read=function(r){return e._read(r)}}},b.prototype.random=function(){return this._fromJSON(M.prototype.random())},b.prototype._fromBuffer=h.abstractFunction,b.prototype._toBuffer=h.abstractFunction,b.prototype._fromJSON=h.abstractFunction,b.prototype._toJSON=h.abstractFunction,b.prototype._isValid=h.abstractFunction,b.prototype.compare=h.abstractFunction;function A(t,i){var e=t.name;if(typeof e!="string"||!h.isValidName(e))throw new Error(R("invalid field name: %s",e));this.name=e,this.type=a.forSchema(t.type,i),this.aliases=t.aliases||[],this.doc=t.doc!==void 0?""+t.doc:void 0,this._order=function(f){switch(f){case"ascending":return 1;case"descending":return-1;case"ignore":return 0;default:throw new Error(R("invalid order: %j",f))}}(t.order===void 0?"ascending":t.order);var r=t.default;if(r!==void 0){var n=this.type,o;try{o=n._copy(r,{coerce:2,wrap:2})}catch(f){var s=R("incompatible field default %j (%s)",r,f.message);throw a.isType(n,"union")&&(s+=R(", union defaults must match the first branch's type (%j)",n.types[0])),new Error(s)}he(n.typeName)&&n.typeName!=="bytes"?this.defaultValue=function(){return o}:this.defaultValue=function(){return n._copy(o)}}Object.freeze(this)}A.prototype.defaultValue=function(){},Object.defineProperty(A.prototype,"order",{enumerable:!0,get:function(){return["descending","ignore","ascending"][this._order+1]}}),A.prototype.getAliases=function(){return this.aliases},A.prototype.getDefault=A.prototype.defaultValue,A.prototype.getName=function(){return this.name},A.prototype.getOrder=function(){return this.order},A.prototype.getType=function(){return this.type};function V(t){this._readerType=t,this._read=null,this.itemsType=null,this.size=0,this.symbols=null,this.valuesType=null}V.prototype._peek=a.prototype._peek,V.prototype.inspect=function(){return"<Resolver>"};function Z(){this.str=void 0}function K(t,i,e,r){if(e){if(e._readerType!==t)throw new Error("invalid resolver");return e._read(i,r)}else return t._read(i)}function ce(t){var i={};t.name&&(i[t.name]=!0);var e=t.aliases,r,n;for(r=0,n=e.length;r<n;r++)i[e[r]]=!0;return Object.keys(i)}function pe(t,i,e){if(!i.name)return!0;var r=e?i.name:h.unqualify(i.name),n=ce(t),o,s,f;for(o=0,s=n.length;o<s;o++)if(f=n[o],e||(f=h.unqualify(f)),f===r)return!0;return!1}function he(t){var i=$[t];return i&&i.prototype instanceof w}function ge(t){if(t==="error")t="record";else{var i=/^([^:]+):(.*)$/.exec(t);i&&(i[1]==="union"?t=i[2]+"Union":t=i[1])}return h.capitalize(t)+"Type"}function ve(t){var i=t.readLong();return i<0&&(i=-i,t.skipLong()),i}function Ce(t){return t>=-9007199254740990&&t<=9007199254740990}function je(t){return t&&t.type==="Buffer"&&Array.isArray(t.data)}function ae(t,i){throw new Error(R("invalid %j: %j",i.schema(),t))}function ke(t,i){var e=h.unqualify(t);return he(e)?e:h.qualify(t,i)}function $e(t){var i=t.typeName;switch(i){case"double":case"float":case"int":case"long":return"number";case"bytes":case"fixed":return"buffer";case"enum":return"string";case"map":case"error":case"record":return"object";default:return i}}function xe(t){if(t===null)return"null";var i=typeof t;if(i==="object"){if(Array.isArray(t))return"array";if(g.isBuffer(t))return"buffer"}return i}function Te(t){var i={},e,r,n,o;for(e=0,r=t.length;e<r;e++)if(o=t[e],!a.isType(o,"logical")){if(n=$e(o),i[n])return!0;i[n]=!0}return!1}function Fe(t){var i=["int","long","float","double"],e=-1,r=null,n,o,s,f;for(n=0,o=t.length;n<o;n++)s=t[n],f=i.indexOf(s.typeName),f>e&&(e=f,r=s);return r}function Ge(t,i){var e={},r,n,o,s;for(r=0,n=t.length;r<n;r++){if(o=t[r],o.typeName==="string")return o;s=o.symbols;var f,y;for(f=0,y=s.length;f<y;f++)e[s[f]]=!0}return a.forSchema({type:"enum",symbols:Object.keys(e)},i)}function Ke(t,i){var e=-1,r,n,o;for(r=0,n=t.length;r<n;r++){if(o=t[r],o.typeName==="bytes")return o;e===-1?e=o.size:o.size!==e&&(e=-2)}return e<0?a.forSchema("bytes",i):t[0]}function Je(t,i){var e=[],r={},n={},o=!0,s,f,y,k;for(s=0,f=t.length;s<f;s++)if(y=t[s],y.typeName==="map")o=!1,e.push(y.valuesType);else{k=y.fields;var C,L,F,J,B,H;for(C=0,L=k.length;C<L;C++)F=k[C],B=F.name,H=F.type,e.push(H),o&&(r[B]||(r[B]=[]),r[B].push(H),J=F.defaultValue(),J!==void 0&&(n[B]=J))}if(o){var W=Object.keys(r);for(s=0,f=W.length;s<f;s++)B=W[s],r[B].length<t.length&&n[B]===void 0&&(i&&i.strictDefaults?o=!1:(r[B].unshift(a.forSchema("null",i)),n[B]=null))}var ie;return o?ie={type:"record",fields:W.map(function(se){var ue=a.forTypes(r[se],i),we=n[se];if(we!==void 0&&~ue.typeName.indexOf("union")){var ye=ue.types.slice(),be,st;for(be=0,st=ye.length;be<st&&!ye[be].isValid(we);be++);if(be>0){var kt=ye[0];ye[0]=ye[be],ye[be]=kt,ue=a.forSchema(ye,i)}}return{name:se,type:ue,default:n[se]}})}:ie={type:"map",values:a.forTypes(e,i)},a.forSchema(ie,i)}l.exports={Type:a,getTypeBucket:$e,getValueBucket:xe,isPrimitive:he,builtins:function(){var t={LogicalType:p,UnwrappedUnionType:E,WrappedUnionType:S},i=Object.keys($),e,r,n;for(e=0,r=i.length;e<r;e++)n=i[e],t[ge(n)]=$[n];return t}()}}}),Dt=Ie({"node_modules/avsc/lib/containers.js"(u,l){"use strict";var h=ot(),d=ze(),_=Ue,g=vt,O=De,T=Nt,v=_.Buffer,R={namespace:"org.apache.avro.file"},$=h.Type.forSchema("long",R),P=h.Type.forSchema({type:"map",values:"bytes"},R),Y=h.Type.forSchema({name:"Header",type:"record",fields:[{name:"magic",type:{type:"fixed",name:"Magic",size:4}},{name:"meta",type:P},{name:"sync",type:{type:"fixed",name:"Sync",size:16}}]},R),te=h.Type.forSchema({name:"Block",type:"record",fields:[{name:"count",type:"long"},{name:"data",type:"bytes"},{name:"sync",type:"Sync"}]},R),m=d.bufferFrom("Obj"),a=O.format,w=d.Tap;function j(E,S){S=S||{};var N=!!S.noDecode;g.Duplex.call(this,{readableObjectMode:!N,allowHalfOpen:!1}),this._type=h.Type.forSchema(E),this._tap=new w(d.newBuffer(0)),this._writeCb=null,this._needPush=!1,this._readValue=q(N,this._type),this._finished=!1,this.on("finish",function(){this._finished=!0,this._read()})}O.inherits(j,g.Duplex),j.prototype._write=function(E,S,N){this._writeCb=N;var x=this._tap;x.buf=v.concat([x.buf.slice(x.pos),E]),x.pos=0,this._needPush&&(this._needPush=!1,this._read())},j.prototype._read=function(){this._needPush=!1;var E=this._tap,S=E.pos,N=this._readValue(E);E.isValid()?this.push(N):this._finished?this.push(null):(E.pos=S,this._needPush=!0,this._writeCb&&this._writeCb())};function z(E){E=E||{};var S=!!E.noDecode;g.Duplex.call(this,{allowHalfOpen:!0,readableObjectMode:!S}),this._rType=E.readerSchema!==void 0?h.Type.forSchema(E.readerSchema):void 0,this._wType=null,this._codecs=E.codecs,this._codec=void 0,this._parseHook=E.parseHook,this._tap=new w(d.newBuffer(0)),this._blockTap=new w(d.newBuffer(0)),this._syncMarker=null,this._readValue=null,this._noDecode=S,this._queue=new d.OrderedQueue,this._decompress=null,this._index=0,this._remaining=void 0,this._needPush=!1,this._finished=!1,this.on("finish",function(){this._finished=!0,this._needPush&&this._read()})}O.inherits(z,g.Duplex),z.defaultCodecs=function(){return{null:function(E,S){S(null,E)},deflate:T.inflateRaw}},z.getDefaultCodecs=z.defaultCodecs,z.prototype._decodeHeader=function(){var E=this._tap;if(E.buf.length<m.length)return!1;if(!m.equals(E.buf.slice(0,m.length)))return this.emit("error",new Error("invalid magic bytes")),!1;var S=Y._read(E);if(!E.isValid())return!1;this._codec=(S.meta["avro.codec"]||"null").toString();var N=this._codecs||z.getDefaultCodecs();if(this._decompress=N[this._codec],!this._decompress){this.emit("error",new Error(a("unknown codec: %s",this._codec)));return}try{var x=JSON.parse(S.meta["avro.schema"].toString());this._parseHook&&(x=this._parseHook(x)),this._wType=h.Type.forSchema(x)}catch(I){this.emit("error",I);return}try{this._readValue=q(this._noDecode,this._wType,this._rType)}catch(I){this.emit("error",I);return}return this._syncMarker=S.sync,this.emit("metadata",this._wType,this._codec,S),!0},z.prototype._write=function(E,S,N){var x=this._tap;if(x.buf=v.concat([x.buf,E]),x.pos=0,!this._decodeHeader()){process.nextTick(N);return}this._write=this._writeChunk,this._write(d.newBuffer(0),S,N)},z.prototype._writeChunk=function(E,S,N){var x=this._tap;x.buf=v.concat([x.buf.slice(x.pos),E]),x.pos=0;for(var I=1,X;X=Q(x);){if(!this._syncMarker.equals(X.sync)){this.emit("error",new Error("invalid sync marker"));return}I++,this._decompress(X.data,this._createBlockCallback(X.data.length,X.count,c))}c();function c(){--I||N()}},z.prototype._createBlockCallback=function(E,S,N){var x=this,I=this._index++;return function(X,c){if(X){var p=new Error(a("%s codec decompression error",x._codec));p.cause=X,x.emit("error",p),N()}else x.emit("block",new G(S,c.length,E)),x._queue.push(new D(I,c,N,S)),x._needPush&&x._read()}},z.prototype._read=function(){this._needPush=!1;var E=this._blockTap;if(!this._remaining){var S=this._queue.pop();if(!S||!S.count){this._finished?this.push(null):this._needPush=!0,S&&S.cb();return}S.cb(),this._remaining=S.count,E.buf=S.buf,E.pos=0}this._remaining--;var N;try{if(N=this._readValue(E),!E.isValid())throw new Error("truncated block")}catch(x){this._remaining=0,this.emit("error",x);return}this.push(N)};function ee(E,S){S=S||{},g.Transform.call(this,{writableObjectMode:!0,allowHalfOpen:!1}),this._type=h.Type.forSchema(E),this._writeValue=function(N,x){try{this._type._write(N,x)}catch(I){this.emit("typeError",I,x,this._type)}},this._tap=new w(d.newBuffer(S.batchSize||65536)),this.on("typeError",function(N){this.emit("error",N)})}O.inherits(ee,g.Transform),ee.prototype._transform=function(E,S,N){var x=this._tap,I=x.buf,X=x.pos;if(this._writeValue(x,E),!x.isValid()){X&&this.push(ne(x.buf,0,X));var c=x.pos-X;c>I.length&&(x.buf=d.newBuffer(2*c)),x.pos=0,this._writeValue(x,E)}N()},ee.prototype._flush=function(E){var S=this._tap,N=S.pos;N&&this.push(S.buf.slice(0,N)),E()};function M(E,S){S=S||{},g.Duplex.call(this,{allowHalfOpen:!0,writableObjectMode:!0});var N;if(h.Type.isType(E)?(N=E,E=void 0):N=h.Type.forSchema(E),this._schema=E,this._type=N,this._writeValue=function(I,X){try{this._type._write(I,X)}catch(c){return this.emit("typeError",c,X,this._type),!1}return!0},this._blockSize=S.blockSize||65536,this._tap=new w(d.newBuffer(this._blockSize)),this._codecs=S.codecs,this._codec=S.codec||"null",this._blockCount=0,this._syncMarker=S.syncMarker||new d.Lcg().nextBuffer(16),this._queue=new d.OrderedQueue,this._pending=0,this._finished=!1,this._needHeader=!1,this._needPush=!1,this._metadata=S.metadata||{},!P.isValid(this._metadata))throw new Error("invalid metadata");var x=this._codec;if(this._compress=(this._codecs||M.getDefaultCodecs())[x],!this._compress)throw new Error(a("unsupported codec: %s",x));switch(S.omitHeader!==void 0&&(S.writeHeader=S.omitHeader?"never":"auto"),S.writeHeader){case!1:case"never":break;case void 0:case"auto":this._needHeader=!0;break;default:this._writeHeader()}this.on("finish",function(){this._finished=!0,this._blockCount?this._flushChunk():this._finished&&this._needPush&&this.push(null)}),this.on("typeError",function(I){this.emit("error",I)})}O.inherits(M,g.Duplex),M.defaultCodecs=function(){return{null:function(E,S){S(null,E)},deflate:T.deflateRaw}},M.getDefaultCodecs=M.defaultCodecs,M.prototype._writeHeader=function(){var E=JSON.stringify(this._schema?this._schema:this._type.getSchema({exportAttrs:!0})),S=d.copyOwnProperties(this._metadata,{"avro.schema":d.bufferFrom(E),"avro.codec":d.bufferFrom(this._codec)},!0),N=Y.getRecordConstructor(),x=new N(m,S,this._syncMarker);this.push(x.toBuffer())},M.prototype._write=function(E,S,N){this._needHeader&&(this._writeHeader(),this._needHeader=!1);var x=this._tap,I=x.pos,X=!1;if(this._writeValue(x,E)){if(!x.isValid()){I&&(this._flushChunk(I,N),X=!0);var c=x.pos-I;c>this._blockSize&&(this._blockSize=c*2),x.buf=d.newBuffer(this._blockSize),x.pos=0,this._writeValue(x,E)}this._blockCount++}else x.pos=I;X||N()},M.prototype._flushChunk=function(E,S){var N=this._tap;E=E||N.pos,this._compress(N.buf.slice(0,E),this._createBlockCallback(E,S)),this._blockCount=0},M.prototype._read=function(){var E=this,S=this._queue.pop();if(!S){this._finished&&!this._pending?process.nextTick(function(){E.push(null)}):this._needPush=!0;return}this.push($.toBuffer(S.count,!0)),this.push($.toBuffer(S.buf.length,!0)),this.push(S.buf),this.push(this._syncMarker),this._finished||S.cb()},M.prototype._createBlockCallback=function(E,S){var N=this,x=this._index++,I=this._blockCount;return this._pending++,function(X,c){if(X){var p=new Error(a("%s codec compression error",N._codec));p.cause=X,N.emit("error",p);return}N._pending--,N.emit("block",new G(I,E,c.length)),N._queue.push(new D(x,c,S,I)),N._needPush&&(N._needPush=!1,N._read())}};function G(E,S,N){this.valueCount=E,this.rawDataLength=S,this.compressedDataLength=N}function D(E,S,N,x){this.index=E,this.buf=S,this.cb=N,this.count=x|0}function Q(E){var S=E.pos,N=te._read(E);return E.isValid()?N:(E.pos=S,null)}function q(E,S,N){if(E)return function(I){return function(X){var c=X.pos;return I(X),X.buf.slice(c,X.pos)}}(S._skip);if(N){var x=N.createResolver(S);return function(I){return x._read(I)}}else return function(I){return S._read(I)}}function ne(E,S,N){var x=d.newBuffer(N);return E.copy(x,0,S,S+N),x}l.exports={BLOCK_TYPE:te,HEADER_TYPE:Y,MAGIC_BYTES:m,streams:{BlockDecoder:z,BlockEncoder:M,RawDecoder:j,RawEncoder:ee}}}}),jt=Ie({"node_modules/avsc/lib/services.js"(u,l){"use strict";var h=ot(),d=ze(),_=Ue,g=At,O=vt,T=De,v=_.Buffer,R=d.Tap,$=h.Type,P=T.debuglog("avsc:services"),Y=T.format,te={namespace:"org.apache.avro.ipc"},m=$.forSchema("boolean",te),a=$.forSchema({type:"map",values:"bytes"},te),w=$.forSchema("string",te),j=$.forSchema({name:"HandshakeRequest",type:"record",fields:[{name:"clientHash",type:{name:"MD5",type:"fixed",size:16}},{name:"clientProtocol",type:["null","string"],default:null},{name:"serverHash",type:"MD5"},{name:"meta",type:["null",a],default:null}]},te),z=$.forSchema({name:"HandshakeResponse",type:"record",fields:[{name:"match",type:{name:"HandshakeMatch",type:"enum",symbols:["BOTH","CLIENT","NONE"]}},{name:"serverProtocol",type:["null","string"],default:null},{name:"serverHash",type:["null","MD5"],default:null},{name:"meta",type:["null",a],default:null}]},te),ee=16,M=new G("",$.forSchema({name:"PingRequest",type:"record",fields:[]},te),$.forSchema(["string"],te),$.forSchema("null",te));function G(e,r,n,o,s,f){if(this.name=e,!$.isType(r,"record"))throw new Error("invalid request type");if(this.requestType=r,!$.isType(n,"union")||!$.isType(n.getTypes()[0],"string"))throw new Error("invalid error type");if(this.errorType=n,s&&(!$.isType(o,"null")||n.getTypes().length>1))throw new Error("inapplicable one-way parameter");this.responseType=o,this.oneWay=!!s,this.doc=f!==void 0?""+f:void 0,Object.freeze(this)}G.forSchema=function(e,r,n){if(n=n||{},!d.isValidName(e))throw new Error(Y("invalid message name: %s",e));if(!Array.isArray(r.request))throw new Error(Y("invalid message request: %s",e));var o=Y("%s.%sRequest",te.namespace,d.capitalize(e)),s=$.forSchema({name:o,type:"record",namespace:n.namespace||"",fields:r.request},n);if(delete n.registry[o],!r.response)throw new Error(Y("invalid message response: %s",e));var f=$.forSchema(r.response,n);if(r.errors!==void 0&&!Array.isArray(r.errors))throw new Error(Y("invalid message errors: %s",e));var y=$.forSchema(["string"].concat(r.errors||[]),n),k=!!r["one-way"];return new G(e,s,y,f,k,r.doc)},G.prototype.schema=$.prototype.getSchema,G.prototype._attrs=function(e){var r=this.requestType._attrs(e),n={request:r.fields,response:this.responseType._attrs(e)},o=this.doc;o!==void 0&&(n.doc=o);var s=this.errorType._attrs(e);return s.length>1&&(n.errors=s.slice(1)),this.oneWay&&(n["one-way"]=!0),n},d.addDeprecatedGetters(G,["name","errorType","requestType","responseType"]),G.prototype.isOneWay=T.deprecate(function(){return this.oneWay},"use `.oneWay` directly instead of `.isOneWay()`");function D(e,r,n,o,s){if(typeof e!="string")return D.forProtocol(e,r);this.name=e,this._messagesByName=r||{},this.messages=Object.freeze(d.objectValues(this._messagesByName)),this._typesByName=n||{},this.types=Object.freeze(d.objectValues(this._typesByName)),this.protocol=o,this._hashStr=d.getHash(JSON.stringify(o)).toString("binary"),this.doc=o.doc?""+o.doc:void 0,this._server=s||this.createServer({silent:!0}),Object.freeze(this)}D.Client=q,D.Server=ne,D.compatible=function(e,r){try{Ce(e,r)}catch{return!1}return!0},D.forProtocol=function(e,r){r=r||{};var n=e.protocol;if(!n)throw new Error("missing protocol name");if(e.namespace!==void 0)r.namespace=e.namespace;else{var o=/^(.*)\.[^.]+$/.exec(n);o&&(r.namespace=o[1])}n=d.qualify(n,r.namespace),e.types&&e.types.forEach(function(f){$.forSchema(f,r)});var s;return e.messages&&(s={},Object.keys(e.messages).forEach(function(f){s[f]=G.forSchema(f,e.messages[f],r)})),new D(n,s,r.registry,e)},D.isService=function(e){return!!e&&e.hasOwnProperty("_hashStr")},D.prototype.createClient=function(e){var r=new q(this,e);return process.nextTick(function(){if(e&&e.server){var n={objectMode:!0},o=[new O.PassThrough(n),new O.PassThrough(n)];e.server.createChannel({readable:o[0],writable:o[1]},n),r.createChannel({readable:o[1],writable:o[0]},n)}else e&&e.transport&&r.createChannel(e.transport)}),r},D.prototype.createServer=function(e){return new ne(this,e)},Object.defineProperty(D.prototype,"hash",{enumerable:!0,get:function(){return d.bufferFrom(this._hashStr,"binary")}}),D.prototype.message=function(e){return this._messagesByName[e]},D.prototype.type=function(e){return this._typesByName[e]},D.prototype.inspect=function(){return Y("<Service %j>",this.name)},d.addDeprecatedGetters(D,["message","messages","name","type","types"]),D.prototype.createEmitter=T.deprecate(function(e,r){r=r||{};var n=this.createClient({cache:r.cache,buffering:!1,strictTypes:r.strictErrors,timeout:r.timeout}),o=n.createChannel(e,r);return $e(n,o),o},"use `.createClient()` instead of `.createEmitter()`"),D.prototype.createListener=T.deprecate(function(e,r){if(r&&r.strictErrors)throw new Error("use `.createServer()` to support strict errors");return this._server.createChannel(e,r)},"use `.createServer().createChannel()` instead of `.createListener()`"),D.prototype.emit=T.deprecate(function(e,r,n,o){if(!n||!this.equals(n.client._svc$))throw new Error("invalid emitter");var s=n.client;return q.prototype.emitMessage.call(s,e,r,o&&o.bind(this)),n.getPending()},"create a client via `.createClient()` to emit messages instead of `.emit()`"),D.prototype.equals=T.deprecate(function(e){return D.isService(e)&&this.getFingerprint().equals(e.getFingerprint())},"equality testing is deprecated, compare the `.protocol`s instead"),D.prototype.getFingerprint=T.deprecate(function(e){return d.getHash(JSON.stringify(this.protocol),e)},"use `.hash` instead of `.getFingerprint()`"),D.prototype.getSchema=T.deprecate($.prototype.getSchema,"use `.protocol` instead of `.getSchema()`"),D.prototype.on=T.deprecate(function(e,r){var n=this;return this._server.onMessage(e,function(o,s){return r.call(n,o,this.channel,s)}),this},"use `.createServer().onMessage()` instead of `.on()`"),D.prototype.subprotocol=T.deprecate(function(){var e=this._server,r={strictTypes:e._strict,cache:e._cache},n=new ne(e.service,r);return n._handlers=Object.create(e._handlers),new D(this.name,this._messagesByName,this._typesByName,this.protocol,n)},"`.subprotocol()` will be removed in 5.1"),D.prototype._attrs=function(e){var r={protocol:this.name},n=[];this.types.forEach(function(s){if(s.getName()!==void 0){var f=s._attrs(e);typeof f!="string"&&n.push(f)}}),n.length&&(r.types=n);var o=Object.keys(this._messagesByName);return o.length&&(r.messages={},o.forEach(function(s){r.messages[s]=this._messagesByName[s]._attrs(e)},this)),e&&e.exportAttrs&&this.doc!==void 0&&(r.doc=this.doc),r};function Q(e,r,n){n===void 0&&typeof r=="function"&&(n=r,r=void 0);var o=new D({protocol:"Empty"},te),s;o.createClient({timeout:r&&r.timeout}).createChannel(e,{scope:r&&r.scope,endWritable:typeof e=="function"}).once("handshake",function(f,y){s=y.serverProtocol,this.destroy(!0)}).once("eot",function(f,y){y&&!/interrupted/.test(y)?n(y):n(null,JSON.parse(s))})}function q(e,r){r=r||{},g.EventEmitter.call(this),this._svc$=e,this._channels$=[],this._fns$=[],this._buffering$=!!r.buffering,this._cache$=r.cache||{},this._policy$=r.channelPolicy,this._strict$=!!r.strictTypes,this._timeout$=d.getOption(r,"timeout",1e4),r.remoteProtocols&&je(this._cache$,r.remoteProtocols,e,!0),this._svc$.messages.forEach(function(n){this[n.name]=this._createMessageHandler$(n)},this)}T.inherits(q,g.EventEmitter),q.prototype.activeChannels=function(){return this._channels$.slice()},q.prototype.createChannel=function(e,r){var n=r&&r.objectMode,o;if(typeof e=="function"){var s;n?s=e:s=function(F){var J=new K,B=e(function(H,W){if(H){F(H);return}var ie=new Z().once("error",function(se){o.destroy(se)});F(null,W.pipe(ie))});if(B)return J.pipe(B),J},o=new S(this,s,r)}else{var f,y;if(Je(e)?f=y=e:(f=e.readable,y=e.writable),!n){var k=new ce;f=f.pipe(k);var C=new pe;C.pipe(y),y=C}o=new N(this,f,y,r),n||(o.once("eot",function(){f.unpipe(k),C.unpipe(y)}),k.once("error",function(F){o.destroy(F)}))}var L=this._channels$;return L.push(o),o.once("_drain",function(){L.splice(L.indexOf(this),1)}),this._buffering$=!1,this.emit("channel",o),o},q.prototype.destroyChannels=function(e){this._channels$.forEach(function(r){r.destroy(e&&e.noWait)})},q.prototype.emitMessage=function(e,r,n,o){var s=t(this._svc$,e),f=new c(s,{},r);this._emitMessage$(f,n,o)},q.prototype.remoteProtocols=function(){return ae(this._cache$,!0)},Object.defineProperty(q.prototype,"service",{enumerable:!0,get:function(){return this._svc$}}),q.prototype.use=function(){var e,r,n;for(e=0,r=arguments.length;e<r;e++)n=arguments[e],this._fns$.push(n.length<3?n(this):n);return this},q.prototype._emitMessage$=function(e,r,n){!n&&typeof r=="function"&&(n=r,r=void 0);var o=this,s=this._channels$,f=s.length;if(!f){if(this._buffering$)P("no active client channels, buffering call"),this.once("channel",function(){this._emitMessage$(e,r,n)});else{var y=new Error("no active channels");process.nextTick(function(){n?n.call(new b(e._msg),y):o.emit("error",y)})}return}r=r||{},r.timeout===void 0&&(r.timeout=this._timeout$);var k;if(f===1)k=s[0];else if(this._policy$){if(k=this._policy$(this._channels$.slice()),!k){P("policy returned no channel, skipping call");return}}else k=s[Math.floor(Math.random()*f)];k._emit(e,r,function(C,L){var F=this,J=F.message.errorType;if(C){o._strict$&&(C=J.clone(C.message,{wrapUnions:!0})),B(C);return}if(!L){B();return}C=L.error,o._strict$||(C===void 0?C=null:$.isType(J,"union:unwrapped")?typeof C=="string"&&(C=new Error(C)):C&&C.string&&typeof C.string=="string"&&(C=new Error(C.string))),B(C,L.response);function B(H,W){n?n.call(F,H,W):H&&o.emit("error",H)}})},q.prototype._createMessageHandler$=function(e){var r=e.requestType.getFields(),n=r.map(function(s){return s.getName()}),o="return function "+e.name+"(";return n.length&&(o+=n.join(", ")+", "),o+=`opts, cb) {
`,o+="  var req = {",o+=n.map(function(s){return s+": "+s}).join(", "),o+=`};
`,o+="  return this.emitMessage('"+e.name+`', req, opts, cb);
`,o+="};",new Function(o)()};function ne(e,r){r=r||{},g.EventEmitter.call(this),this.service=e,this._handlers={},this._fns=[],this._channels={},this._nextChannelId=1,this._cache=r.cache||{},this._defaultHandler=r.defaultHandler,this._sysErrFormatter=r.systemErrorFormatter,this._silent=!!r.silent,this._strict=!!r.strictTypes,r.remoteProtocols&&je(this._cache,r.remoteProtocols,e,!1),e.messages.forEach(function(n){var o=n.name;r.noCapitalize||(o=d.capitalize(o)),this["on"+o]=this._createMessageHandler(n)},this)}T.inherits(ne,g.EventEmitter),ne.prototype.activeChannels=function(){return d.objectValues(this._channels)},ne.prototype.createChannel=function(e,r){var n=r&&r.objectMode,o;if(typeof e=="function"){var s;n?s=e:s=function(J){var B=new Z().once("error",function(H){o.destroy(H)});return e(function(H,W){if(H){J(H);return}var ie=new K;ie.pipe(W),J(null,ie)}).pipe(B)},o=new I(this,s,r)}else{var f,y;if(Je(e)?f=y=e:(f=e.readable,y=e.writable),!n){var k=new ce;f=f.pipe(k);var C=new pe;C.pipe(y),y=C}o=new X(this,f,y,r),n||(o.once("eot",function(){f.unpipe(k),C.unpipe(y)}),k.once("error",function(J){o.destroy(J)}))}this.listeners("error").length||this.on("error",this._onError);var L=this._nextChannelId++,F=this._channels;return F[L]=o.once("eot",function(){delete F[L]}),this.emit("channel",o),o},ne.prototype.onMessage=function(e,r){return t(this.service,e),this._handlers[e]=r,this},ne.prototype.remoteProtocols=function(){return ae(this._cache,!1)},ne.prototype.use=function(){var e,r,n;for(e=0,r=arguments.length;e<r;e++)n=arguments[e],this._fns.push(n.length<3?n(this):n);return this},ne.prototype._createMessageHandler=function(e){var r=e.name,n=e.requestType.fields,o=n.length,s=n.length?", "+n.map(function(y){return"req."+y.name}).join(", "):"",f=`return function (handler) {
`;return f+="  if (handler.length > "+o+`) {
`,f+="    return this.onMessage('"+r+`', function (req, cb) {
`,f+="      return handler.call(this"+s+`, cb);
`,f+=`    });
`,f+=`  } else {
`,f+="    return this.onMessage('"+r+`', function (req) {
`,f+="      return handler.call(this"+s+`);
`,f+=`    });
`,f+=`  }
`,f+=`};
`,new Function(f)()},ne.prototype._onError=function(e){!this._silent&&e.rpcCode!=="UNKNOWN_PROTOCOL"&&(console.error(),e.rpcCode?(console.error(e.rpcCode),console.error(e.cause)):(console.error("INTERNAL_SERVER_ERROR"),console.error(e)))};function E(e,r){r=r||{},g.EventEmitter.call(this),this.client=e,this.timeout=d.getOption(r,"timeout",e._timeout$),this._endWritable=!!d.getOption(r,"endWritable",!0),this._prefix=Ge(r.scope);var n=e._cache$,o=e._svc$,s=r.serverHash;s||(s=o.hash);var f=n[s];f||(s=o.hash,f=n[s]=new V(o,o,s)),this._adapter=f,this._registry=new A(this,ee),this.pending=0,this.destroyed=!1,this.draining=!1,this.once("_eot",function(y,k){P("client channel EOT"),this.destroyed=!0,this.emit("eot",y,k)})}T.inherits(E,g.EventEmitter),E.prototype.destroy=function(e){P("destroying client channel"),this.draining||(this.draining=!0,this.emit("_drain"));var r=this._registry,n=this.pending;e&&r.clear(),e||!n?ke(e)?(P("fatal client channel error: %s",e),this.emit("_eot",n,e)):this.emit("_eot",n):P("client channel entering drain mode (%s pending)",n)},E.prototype.ping=function(e,r){!r&&typeof e=="function"&&(r=e,e=void 0);var n=this,o=new c(M);this._emit(o,{timeout:e},function(s){r?r.call(n,s):s&&n.destroy(s)})},E.prototype._createHandshakeRequest=function(e,r){var n=this.client._svc$;return{clientHash:n.hash,clientProtocol:r?null:JSON.stringify(n.protocol),serverHash:e._hash}},E.prototype._emit=function(e,r,n){var o=e._msg,s=o.oneWay?void 0:new p(o,{}),f=new b(o,this),y=this;this.pending++,process.nextTick(function(){if(!o.name)k(e,s,C);else{y.emit("outgoingCall",f,r);var F=y.client._fns$;P("starting client middleware chain (%s middleware)",F.length),i({fns:F,ctx:f,wreq:e,wres:s,onTransition:k,onCompletion:C,onError:L})}});function k(F,J,B){var H,W;if(y.destroyed)H=new Error("channel destroyed");else try{W=F.toBuffer()}catch{H=Fe(Y("invalid %j request",o.name),F,[{name:"headers",type:a},{name:"request",type:o.requestType}])}if(H){B(H);return}var ie=r&&r.timeout!==void 0?r.timeout:y.timeout,se=y._registry.add(ie,function(ue,we,ye){if(!ue&&!o.oneWay)try{ye._decodeResponse(we,J,o)}catch(be){ue=be}B(ue)});se|=y._prefix,P("sending message %s",se),y._send(se,W,!!o&&o.oneWay)}function C(F){y.pending--,n.call(f,F,s),y.draining&&!y.destroyed&&!y.pending&&y.destroy()}function L(F){y.client.emit("error",F,y)}},E.prototype._getAdapter=function(e){var r=e.serverHash,n=this.client._cache$,o=n[r];if(o)return o;var s=JSON.parse(e.serverProtocol),f=D.forProtocol(s);return o=new V(this.client._svc$,f,r,!0),n[r]=o},E.prototype._matchesPrefix=function(e){return Ke(e,this._prefix)},E.prototype._send=d.abstractFunction,d.addDeprecatedGetters(E,["pending","timeout"]),E.prototype.getCache=T.deprecate(function(){return this.client._cache$},"use `.remoteProtocols()` instead of `.getCache()`"),E.prototype.getProtocol=T.deprecate(function(){return this.client._svc$},"use `.service` instead or `.getProtocol()`"),E.prototype.isDestroyed=T.deprecate(function(){return this.destroyed},"use `.destroyed` instead of `.isDestroyed`");function S(e,r,n){E.call(this,e,n),this._writableFactory=r,(!n||!n.noPing)&&(P("emitting ping request"),this.ping())}T.inherits(S,E),S.prototype._send=function(e,r){var n=this._registry.get(e),o=this._adapter,s=this;return process.nextTick(f),!0;function f(y){if(!s.destroyed){var k=s._createHandshakeRequest(o,!y),C=s._writableFactory.call(s,function(L,F){if(L){n(L);return}F.on("data",function(J){P("received response %s",J.id);var B=v.concat(J.payload);try{var H=ge(z,B),W=H.head;W.serverHash&&(o=s._getAdapter(W))}catch(se){n(se);return}var ie=W.match;P("handshake match: %s",ie),s.emit("handshake",k,W),ie==="NONE"?process.nextTick(function(){f(!0)}):(s._adapter=o,n(null,H.tail,o))})});if(!C){n(new Error("invalid writable stream"));return}C.write({id:e,payload:[j.toBuffer(k),r]}),s._endWritable&&C.end()}}};function N(e,r,n,o){E.call(this,e,o),this._readable=r,this._writable=n,this._connected=!!(o&&o.noPing),this._readable.on("end",F),this._writable.on("finish",J);var s=this,f=null;this.once("eot",function(){f&&(clearTimeout(f),f=null),s._connected||s.emit("_ready"),this._writable.removeListener("finish",J),this._endWritable&&(P("ending transport"),this._writable.end()),this._readable.removeListener("data",C).removeListener("data",L).removeListener("end",F)});var y;this._connected?this._readable.on("data",L):(this._readable.on("data",C),process.nextTick(k),s.timeout&&(f=setTimeout(function(){s.destroy(new Error("timeout"))},s.timeout)));function k(B){if(!s.destroyed){y=s._createHandshakeRequest(s._adapter,!B);var H=[j.toBuffer(y),d.bufferFrom([0,0])];s._writable.write({id:s._prefix,payload:H})}}function C(B){if(!s._matchesPrefix(B.id)){P("discarding unscoped response %s (still connecting)",B.id);return}var H=v.concat(B.payload);try{var W=ge(z,H).head;W.serverHash&&(s._adapter=s._getAdapter(W))}catch(se){s.destroy(se);return}var ie=W.match;P("handshake match: %s",ie),s.emit("handshake",y,W),ie==="NONE"?process.nextTick(function(){k(!0)}):(P("successfully connected"),f&&(clearTimeout(f),f=null),s._readable.removeListener("data",C).on("data",L),s._connected=!0,s.emit("_ready"),y=null)}function L(B){var H=B.id;if(!s._matchesPrefix(H)){P("discarding unscoped message %s",H);return}var W=s._registry.get(H);W&&process.nextTick(function(){P("received message %s",H),W(null,v.concat(B.payload),s._adapter)})}function F(){s.destroy(!0)}function J(){s.destroy()}}T.inherits(N,E),N.prototype._emit=function(){if(this._connected||this.draining)E.prototype._emit.apply(this,arguments);else{P("queuing request");var e=[],r,n;for(r=0,n=arguments.length;r<n;r++)e.push(arguments[r]);this.once("_ready",function(){this._emit.apply(this,e)})}},N.prototype._send=function(e,r,n){if(n){var o=this;process.nextTick(function(){o._registry.get(e)(null,d.bufferFrom([0,0,0]),o._adapter)})}return this._writable.write({id:e,payload:[r]})};function x(e,r){r=r||{},g.EventEmitter.call(this),this.server=e,this._endWritable=!!d.getOption(r,"endWritable",!0),this._prefix=Ge(r.scope);var n=e._cache,o=e.service,s=o.hash;n[s]||(n[s]=new V(o,o,s)),this._adapter=null,this.destroyed=!1,this.draining=!1,this.pending=0,this.once("_eot",function(f,y){P("server channel EOT"),this.emit("eot",f,y)})}T.inherits(x,g.EventEmitter),x.prototype.destroy=function(e){this.draining||(this.draining=!0,this.emit("_drain")),(e||!this.pending)&&(this.destroyed=!0,ke(e)?(P("fatal server channel error: %s",e),this.emit("_eot",this.pending,e)):this.emit("_eot",this.pending))},x.prototype._createHandshakeResponse=function(e,r){var n=this.server.service,o=n.hash,s=r&&r.serverHash.equals(o);return{match:e?"NONE":s?"BOTH":"CLIENT",serverProtocol:s?null:JSON.stringify(n.protocol),serverHash:s?null:o}},x.prototype._getAdapter=function(e){var r=e.clientHash,n=this.server._cache[r];if(n)return n;if(!e.clientProtocol)throw Te("UNKNOWN_PROTOCOL");var o=JSON.parse(e.clientProtocol),s=D.forProtocol(o);return n=new V(s,this.server.service,r,!0),this.server._cache[r]=n},x.prototype._matchesPrefix=function(e){return Ke(e,this._prefix)},x.prototype._receive=function(e,r,n){var o=this,s;try{s=r._decodeRequest(e)}catch(B){n(o._encodeSystemError(Te("INVALID_REQUEST",B)));return}var f=s._msg,y=new p(f,{});if(!f.name){y.response=null,n(y.toBuffer(),!1);return}var k=new b(f,this);o.emit("incomingCall",k);var C=this.server._fns;P("starting server middleware chain (%s middleware)",C.length),o.pending++,i({fns:C,ctx:k,wreq:s,wres:y,onTransition:L,onCompletion:F,onError:J});function L(B,H,W){var ie=o.server._handlers[f.name];if(ie){var we=!f.oneWay;try{we?ie.call(k,B.request,function(ye,be){we=!1,H.error=ye,H.response=be,W()}):(ie.call(k,B.request),W())}catch(ye){we?(we=!1,W(ye)):J(ye)}}else{var se=o.server._defaultHandler;if(se)se.call(k,B,H,W);else{var ue=new Error(Y("no handler for %s",f.name));W(Te("NOT_IMPLEMENTED",ue))}}}function F(B){o.pending--;var H=o.server,W;if(!B){var ie=y.error,se=H._strict;se||(ke(ie)?y.error=f.errorType.clone(ie.message,{wrapUnions:!0}):ie===null&&(ie=y.error=void 0),ie===void 0&&y.response===void 0&&f.responseType.isValid(null)&&(y.response=null));try{W=y.toBuffer()}catch{y.error!==void 0?B=Fe(Y("invalid %j error",f.name),y,[{name:"headers",type:a},{name:"error",type:f.errorType}]):B=Fe(Y("invalid %j response",f.name),y,[{name:"headers",type:a},{name:"response",type:f.responseType}])}}W?ie!==void 0&&H.emit("error",Te("APPLICATION_ERROR",ie)):W=o._encodeSystemError(B,y.headers),n(W,f.oneWay),o.draining&&!o.pending&&o.destroy()}function J(B){o.server.emit("error",B,o)}},d.addDeprecatedGetters(x,["pending"]),x.prototype.getCache=T.deprecate(function(){return this.server._cache},"use `.remoteProtocols()` instead of `.getCache()`"),x.prototype.getProtocol=T.deprecate(function(){return this.server.service},"use `.service` instead of `.getProtocol()`"),x.prototype.isDestroyed=T.deprecate(function(){return this.destroyed},"use `.destroyed` instead of `.isDestroyed`"),x.prototype._encodeSystemError=function(e,r){var n=this.server;n.emit("error",e,this);var o;n._sysErrFormatter?o=n._sysErrFormatter.call(this,e):e.rpcCode&&(o=e.message);var s;if(r)try{s=a.toBuffer(r)}catch(f){n.emit("error",f,this)}return v.concat([s||d.bufferFrom([0]),d.bufferFrom([1,0]),w.toBuffer(o||"internal server error")])};function I(e,r,n){x.call(this,e,n),this._writable=void 0;var o=this,s;process.nextTick(function(){s=r.call(o,function(C,L){process.nextTick(function(){if(C){k(C);return}o._writable=L.on("finish",k),o.emit("_writable")})}).on("data",f).on("end",y)});function f(C){var L=C.id,F=v.concat(C.payload),J;try{var B=ge(j,F),H=B.head,W=o._getAdapter(H)}catch(ue){J=Te("INVALID_HANDSHAKE_REQUEST",ue)}var ie=o._createHandshakeResponse(J,H);o.emit("handshake",H,ie),J?se(o._encodeSystemError(J)):o._receive(B.tail,W,se);function se(ue){if(!o.destroyed){if(!o._writable){o.once("_writable",function(){se(ue)});return}o._writable.write({id:L,payload:[z.toBuffer(ie),ue]})}o._writable&&o._endWritable&&o._writable.end()}}function y(){o.destroy()}function k(C){s.removeListener("data",f).removeListener("end",y),o.destroy(C||!0)}}T.inherits(I,x);function X(e,r,n,o){x.call(this,e,o),this._adapter=void 0,this._writable=n.on("finish",C),this._readable=r.on("data",f).on("end",k),this.once("_drain",function(){this._readable.removeListener("data",f).removeListener("data",y).removeListener("end",k)}).once("eot",function(){this._writable.removeListener("finish",C),this._endWritable&&this._writable.end()});var s=this;function f(L){var F=L.id;if(!s._matchesPrefix(F))return;var J=v.concat(L.payload),B;try{var H=ge(j,J),W=H.head;s._adapter=s._getAdapter(W)}catch(ue){B=Te("INVALID_HANDSHAKE_REQUEST",ue)}var ie=s._createHandshakeResponse(B,W);s.emit("handshake",W,ie),B?se(s._encodeSystemError(B)):(s._readable.removeListener("data",f).on("data",y),s._receive(H.tail,s._adapter,se));function se(ue){s.destroyed||s._writable.write({id:F,payload:[z.toBuffer(ie),ue]})}}function y(L){var F=L.id;if(s._matchesPrefix(F)){var J=v.concat(L.payload);s._receive(J,s._adapter,function(B,H){s.destroyed||H||s._writable.write({id:F,payload:[B]})})}}function k(){s.destroy()}function C(){s.destroy(!0)}}T.inherits(X,x);function c(e,r,n){this._msg=e,this.headers=r||{},this.request=n||{}}c.prototype.toBuffer=function(){var e=this._msg;return v.concat([a.toBuffer(this.headers),w.toBuffer(e.name),e.requestType.toBuffer(this.request)])};function p(e,r,n,o){this._msg=e,this.headers=r,this.error=n,this.response=o}p.prototype.toBuffer=function(){var e=a.toBuffer(this.headers),r=this.error!==void 0;return v.concat([e,m.toBuffer(r),r?this._msg.errorType.toBuffer(this.error):this._msg.responseType.toBuffer(this.response)])};function b(e,r){this.channel=r,this.locals={},this.message=e,Object.freeze(this)}function A(e,r){this._ctx=e,this._mask=-1>>>(r|0),this._id=0,this._n=0,this._cbs={}}A.prototype.get=function(e){return this._cbs[e&this._mask]},A.prototype.add=function(e,r){this._id=this._id+1&this._mask;var n=this,o=this._id,s;return e>0&&(s=setTimeout(function(){f(new Error("timeout"))},e)),this._cbs[o]=f,this._n++,o;function f(){n._cbs[o]&&(delete n._cbs[o],n._n--,s&&clearTimeout(s),r.apply(n._ctx,arguments))}},A.prototype.clear=function(){Object.keys(this._cbs).forEach(function(e){this._cbs[e](new Error("interrupted"))},this)};function V(e,r,n,o){this._clientSvc=e,this._serverSvc=r,this._hash=n,this._isRemote=!!o,this._readers=Ce(e,r)}V.prototype._decodeRequest=function(e){var r=new R(e),n=a._read(r),o=w._read(r),s,f;if(o?(s=this._serverSvc.message(o),f=this._readers[o+"?"]._read(r)):s=M,!r.isValid())throw new Error(Y("truncated %s request",o||"ping$"));return new c(s,n,f)},V.prototype._decodeResponse=function(e,r,n){var o=new R(e);d.copyOwnProperties(a._read(o),r.headers,!0);var s=m._read(o),f=n.name;if(f){var y=this._readers[f+(s?"*":"!")];if(n=this._clientSvc.message(f),s?r.error=y._read(o):r.response=y._read(o),!o.isValid())throw new Error(Y("truncated %s response",f))}else n=M};function Z(){O.Transform.call(this,{readableObjectMode:!0}),this._id=void 0,this._buf=d.newBuffer(0),this._bufs=[],this.on("finish",function(){this.push(null)})}T.inherits(Z,O.Transform),Z.prototype._transform=function(e,r,n){e=v.concat([this._buf,e]);for(var o;e.length>=4&&e.length>=(o=e.readInt32BE(0))+4;){if(o)this._bufs.push(e.slice(4,o+4));else{var s=this._bufs;this._bufs=[],this.push({id:null,payload:s})}e=e.slice(o+4)}this._buf=e,n()},Z.prototype._flush=function(e){if(this._buf.length||this._bufs.length){var r=this._bufs.slice();r.unshift(this._buf);var n=Te("TRAILING_DATA");n.trailingData=v.concat(r).toString(),this.emit("error",n)}e()};function K(){O.Transform.call(this,{writableObjectMode:!0}),this.on("finish",function(){this.push(null)})}T.inherits(K,O.Transform),K.prototype._transform=function(e,r,n){var o=e.payload,s,f,y;for(s=0,f=o.length;s<f;s++)y=o[s],this.push(he(y.length)),this.push(y);this.push(he(0)),n()};function ce(){O.Transform.call(this,{readableObjectMode:!0}),this._id=void 0,this._frameCount=0,this._buf=d.newBuffer(0),this._bufs=[],this.on("finish",function(){this.push(null)})}T.inherits(ce,O.Transform),ce.prototype._transform=function(e,r,n){for(e=v.concat([this._buf,e]);;){if(this._id===void 0){if(e.length<8){this._buf=e,n();return}this._id=e.readInt32BE(0),this._frameCount=e.readInt32BE(4),e=e.slice(8)}for(var o;this._frameCount&&e.length>=4&&e.length>=(o=e.readInt32BE(0))+4;)this._frameCount--,this._bufs.push(e.slice(4,o+4)),e=e.slice(o+4);if(this._frameCount){this._buf=e,n();return}else{var s={id:this._id,payload:this._bufs};this._bufs=[],this._id=void 0,this.push(s)}}},ce.prototype._flush=Z.prototype._flush;function pe(){O.Transform.call(this,{writableObjectMode:!0}),this.on("finish",function(){this.push(null)})}T.inherits(pe,O.Transform),pe.prototype._transform=function(e,r,n){var o=e.payload,s=o.length,f;f=d.newBuffer(8),f.writeInt32BE(e.id,0),f.writeInt32BE(s,4),this.push(f);var y;for(y=0;y<s;y++)f=o[y],this.push(he(f.length)),this.push(f);n()};function he(e){var r=d.newBuffer(4);return r.writeInt32BE(e),r}function ge(e,r){var n=new R(r),o=e._read(n);if(!n.isValid())throw new Error(Y("truncated %j",e.schema()));return{head:o,tail:n.buf.slice(n.pos)}}function ve(e,r){return e.equals(r)?e:e.createResolver(r)}function Ce(e,r){var n={};return e.messages.forEach(function(o){var s=o.name,f=r.message(s);try{if(!f)throw new Error(Y("missing server message: %s",s));if(f.oneWay!==o.oneWay)throw new Error(Y("inconsistent one-way message: %s",s));n[s+"?"]=ve(f.requestType,o.requestType),n[s+"*"]=ve(o.errorType,f.errorType),n[s+"!"]=ve(o.responseType,f.responseType)}catch(y){throw Te("INCOMPATIBLE_PROTOCOL",y)}}),n}function je(e,r,n,o){Object.keys(r).forEach(function(s){var f=r[s],y,k;o?(y=n,k=D.forProtocol(f)):(y=D.forProtocol(f),k=n),e[s]=new V(y,k,s,!0)})}function ae(e,r){var n={};return Object.keys(e).forEach(function(o){var s=e[o];if(s._isRemote){var f=r?s._serverSvc:s._clientSvc;n[o]=f.protocol}}),n}function ke(e){return!!e&&Object.prototype.toString.call(e)==="[object Error]"}function $e(e,r){return e.on("error",function(n){r.emit("error",n,e)})}function xe(e,r){var n=new Error(e);return n.cause=r,n}function Te(e,r){var n=xe(e.toLowerCase().replace(/_/g," "),r);return n.rpcCode=r&&r.rpcCode?r.rpcCode:e,n}function Fe(e,r,n){var o=[],s,f,y;for(s=0,f=n.length;s<f;s++)y=n[s],y.type.isValid(r[y.name],{errorHook:L});var k=o.map(function(F){return Y("%s = %j but expected %s",F.path,F.value,F.type)}).join(", "),C=new Error(Y("%s (%s)",e,k));return C.details=o,C;function L(F,J,B){var H=[],W,ie,se;for(W=0,ie=F.length;W<ie;W++)se=F[W],isNaN(se)?H.push("."+se):H.push("["+se+"]");o.push({path:y.name+H.join(""),value:J,type:B})}}function Ge(e){return e?d.getHash(e).readInt16BE(0)<<32-ee:0}function Ke(e,r){return(e^r)>>32-ee===0}function Je(e){return!!(e&&e.pipe)}function t(e,r){var n=e.message(r);if(!n)throw new Error(Y("unknown message: %s",r));return n}function i(e){var r=[e.wreq,e.wres],n=[],o;s(0);function s(y){var k=!1;y<e.fns.length?e.fns[y].apply(e.ctx,r.concat(function(C,L){if(k){e.onError(xe("duplicate forward middleware call",C));return}if(k=!0,C||e.wres&&(e.wres.error!==void 0||e.wres.response!==void 0)){o=C,f();return}L&&n.push(L),s(++y)})):e.onTransition.apply(e.ctx,r.concat(function(C){if(k){e.onError(xe("duplicate handler call",C));return}k=!0,o=C,process.nextTick(f)}))}function f(){var y=n.pop();if(y){var k=!1;y.call(e.ctx,o,function(C){if(k){e.onError(xe("duplicate backward middleware call",C));return}o=C,k=!0,f()})}else e.onCompletion.call(e.ctx,o)}}l.exports={Adapter:V,HANDSHAKE_REQUEST_TYPE:j,HANDSHAKE_RESPONSE_TYPE:z,Message:G,Registry:A,Service:D,discoverProtocol:Q,streams:{FrameDecoder:Z,FrameEncoder:K,NettyDecoder:ce,NettyEncoder:pe}}}}),Ft=Ie({"node_modules/avsc/lib/files.js"(u,l){"use strict";var h=mt,d=gt;function _(){var O={};return function(T,v,R){if(T=d.resolve(T),O[T]){process.nextTick(R);return}O[T]=!0,h.readFile(T,{encoding:"utf8"},R)}}function g(){var O={};return function(T,v,R){T=d.resolve(T),O[T]?R():(O[T]=!0,R(null,h.readFileSync(T,{encoding:"utf8"})))}}l.exports={createImportHook:_,createSyncImportHook:g,existsSync:h.existsSync,readFileSync:h.readFileSync}}}),Mt=Ie({"node_modules/avsc/lib/specs.js"(u,l){"use strict";var h=Ft(),d=ze(),_=gt,g=De,O=g.format,T={date:{type:"int",logicalType:"date"},decimal:{type:"bytes",logicalType:"decimal"},time_ms:{type:"long",logicalType:"time-millis"},timestamp_ms:{type:"long",logicalType:"timestamp-millis"}};function v(m,a,w){!w&&typeof a=="function"&&(w=a,a=void 0),a=a||{},a.importHook||(a.importHook=h.createImportHook()),j(m,function(M,G){if(M){w(M);return}if(!G){w(new Error("empty root import"));return}var D=G.types;if(D){var Q=te(G)||"";D.forEach(function(q){q.namespace===Q&&delete q.namespace})}w(null,G)});function j(M,G){a.importHook(M,"idl",function(D,Q){if(D){G(D);return}if(Q===void 0){G();return}try{var q=new $(Q,a),ne=q._readProtocol(Q,a)}catch(E){E.path=M,G(E);return}z(ne.protocol,ne.imports,_.dirname(M),G)})}function z(M,G,D,Q){var q=[];ne();function ne(){var E=G.shift();if(!E){q.reverse();try{q.forEach(function(N){ee(M,N)})}catch(N){Q(N);return}Q(null,M);return}var S=_.join(D,E.name);E.kind==="idl"?j(S,function(N,x){if(N){Q(N);return}x&&q.push(x),ne()}):a.importHook(S,E.kind,function(N,x){if(N){Q(N);return}switch(E.kind){case"protocol":case"schema":if(x===void 0){ne();return}try{var I=JSON.parse(x)}catch(c){c.path=S,Q(c);return}var X=E.kind==="schema"?{types:[I]}:I;q.push(X),ne();return;default:Q(new Error(O("invalid import kind: %s",E.kind)))}})}}function ee(M,G){var D=G.types||[];D.reverse(),D.forEach(function(Q){M.types||(M.types=[]),Q.namespace===void 0&&(Q.namespace=te(G)||""),M.types.unshift(Q)}),Object.keys(G.messages||{}).forEach(function(Q){if(M.messages||(M.messages={}),M.messages[Q])throw new Error(O("duplicate message: %s",Q));M.messages[Q]=G.messages[Q]})}}function R(m){var a;if(typeof m=="string"&&~m.indexOf(_.sep)&&h.existsSync(m)){var w=h.readFileSync(m,{encoding:"utf8"});try{return JSON.parse(w)}catch{var j={importHook:h.createSyncImportHook()};v(m,j,function(ee,M){a=ee?w:M})}}else a=m;if(typeof a!="string"||a==="null")return a;try{return JSON.parse(a)}catch{try{return $.readProtocol(a)}catch{try{return $.readSchema(a)}catch{return a}}}}function $(m,a){a=a||{},this._tk=new P(m),this._ackVoidMessages=!!a.ackVoidMessages,this._implicitTags=!a.delimitedCollections,this._typeRefs=a.typeRefs||T}$.readProtocol=function(m,a){var w=new $(m,a),j=w._readProtocol();if(j.imports.length)throw new Error("unresolvable import");return j.protocol},$.readSchema=function(m,a){var w=new $(m,a),j=w._readJavadoc(),z=w._readType(j===void 0?{}:{doc:j},!0);return w._tk.next({id:"(eof)"}),z},$.prototype._readProtocol=function(){var m=this._tk,a=[],w=[],j={},z;this._readImports(a);var ee={},M=this._readJavadoc();for(M!==void 0&&(ee.doc=M),this._readAnnotations(ee),m.next({val:"protocol"}),m.next({val:"{",silent:!0})||(ee.protocol=m.next({id:"name"}).val,m.next({val:"{"}));!m.next({val:"}",silent:!0});)if(!this._readImports(a)){var G=this._readJavadoc(),D=this._readType({},!0),Q=this._readImports(a,!0),q=void 0;if(z=m.pos,!Q&&(q=this._readMessage(D))){G!==void 0&&q.schema.doc===void 0&&(q.schema.doc=G);var ne=!1;if((q.schema.response==="void"||q.schema.response.type==="void")&&(ne=!this._ackVoidMessages&&!q.schema.errors,q.schema.response==="void"?q.schema.response="null":q.schema.response.type="null"),ne&&(q.schema["one-way"]=!0),j[q.name])throw new Error(O("duplicate message: %s",q.name));j[q.name]=q.schema}else G&&(typeof D=="string"?D={doc:G,type:D}:D.doc===void 0&&(D.doc=G)),w.push(D),m.pos=z,m.next({val:";",silent:!0});G=void 0}return m.next({id:"(eof)"}),w.length&&(ee.types=w),Object.keys(j).length&&(ee.messages=j),{protocol:ee,imports:a}},$.prototype._readAnnotations=function(m){for(var a=this._tk;a.next({val:"@",silent:!0});){for(var w=[];!a.next({val:"(",silent:!0});)w.push(a.next().val);m[w.join("")]=a.next({id:"json"}).val,a.next({val:")"})}},$.prototype._readMessage=function(m){var a=this._tk,w={request:[],response:m};this._readAnnotations(w);var j=a.next().val;if(a.next().val==="("){if(!a.next({val:")",silent:!0}))do w.request.push(this._readField());while(!a.next({val:")",silent:!0})&&a.next({val:","}));var z=a.next();switch(z.val){case"throws":w.errors=[];do w.errors.push(this._readType());while(!a.next({val:";",silent:!0})&&a.next({val:","}));break;case"oneway":w["one-way"]=!0,a.next({val:";"});break;case";":break;default:throw a.error("invalid message suffix",z)}return{name:j,schema:w}}},$.prototype._readJavadoc=function(){var m=this._tk.next({id:"javadoc",emitJavadoc:!0,silent:!0});if(m)return m.val},$.prototype._readField=function(){var m=this._tk,a=this._readJavadoc(),w={type:this._readType()};return a!==void 0&&w.doc===void 0&&(w.doc=a),this._readAnnotations(w),w.name=m.next({id:"name"}).val,m.next({val:"=",silent:!0})&&(w.default=m.next({id:"json"}).val),w},$.prototype._readType=function(m,a){switch(m=m||{},this._readAnnotations(m),m.type=this._tk.next({id:"name"}).val,m.type){case"record":case"error":return this._readRecord(m);case"fixed":return this._readFixed(m);case"enum":return this._readEnum(m,a);case"map":return this._readMap(m);case"array":return this._readArray(m);case"union":if(Object.keys(m).length>1)throw new Error("union annotations are not supported");return this._readUnion();default:var w=this._typeRefs[m.type];return w&&(delete m.type,d.copyOwnProperties(w,m)),Object.keys(m).length>1?m:m.type}},$.prototype._readFixed=function(m){var a=this._tk;return a.next({val:"(",silent:!0})||(m.name=a.next({id:"name"}).val,a.next({val:"("})),m.size=parseInt(a.next({id:"number"}).val),a.next({val:")"}),m},$.prototype._readMap=function(m){var a=this._tk,w=this._implicitTags,j=a.next({val:"<",silent:w})===void 0;return m.values=this._readType(),a.next({val:">",silent:j}),m},$.prototype._readArray=function(m){var a=this._tk,w=this._implicitTags,j=a.next({val:"<",silent:w})===void 0;return m.items=this._readType(),a.next({val:">",silent:j}),m},$.prototype._readEnum=function(m,a){var w=this._tk;w.next({val:"{",silent:!0})||(m.name=w.next({id:"name"}).val,w.next({val:"{"})),m.symbols=[];do m.symbols.push(w.next().val);while(!w.next({val:"}",silent:!0})&&w.next({val:","}));return a&&w.next({val:"=",silent:!0})&&(m.default=w.next().val,w.next({val:";"})),m},$.prototype._readUnion=function(){var m=this._tk,a=[];m.next({val:"{"});do a.push(this._readType());while(!m.next({val:"}",silent:!0})&&m.next({val:","}));return a},$.prototype._readRecord=function(m){var a=this._tk;for(a.next({val:"{",silent:!0})||(m.name=a.next({id:"name"}).val,a.next({val:"{"})),m.fields=[];!a.next({val:"}",silent:!0});)m.fields.push(this._readField()),a.next({val:";"});return m},$.prototype._readImports=function(m,a){for(var w=this._tk,j=0,z=w.pos;w.next({val:"import",silent:!0});){if(!j&&a&&w.next({val:"(",silent:!0})){w.pos=z;return}var ee=w.next({id:"name"}).val,M=JSON.parse(w.next({id:"string"}).val);w.next({val:";"}),m.push({kind:ee,name:M}),j++}return j};function P(m){this._str=m,this.pos=0}P.prototype.next=function(m){var a={pos:this.pos,id:void 0,val:void 0},w=this._skip(m&&m.emitJavadoc);if(typeof w=="string")a.id="javadoc",a.val=w;else{var j=this.pos,z=this._str,ee=z.charAt(j);if(!ee)a.id="(eof)";else if(m&&m.id==="json"?(a.id="json",this.pos=this._endOfJson()):ee==='"'?(a.id="string",this.pos=this._endOfString()):/[0-9]/.test(ee)?(a.id="number",this.pos=this._endOf(/[0-9]/)):/[`A-Za-z_.]/.test(ee)?(a.id="name",this.pos=this._endOf(/[`A-Za-z0-9_.]/)):(a.id="operator",this.pos=j+1),a.val=z.slice(j,this.pos),a.id==="json")try{a.val=JSON.parse(a.val)}catch{throw this.error("invalid JSON",a)}else a.id==="name"&&(a.val=a.val.replace(/`/g,""))}var M;if(m&&m.id&&m.id!==a.id?M=this.error(O("expected ID %s",m.id),a):m&&m.val&&m.val!==a.val&&(M=this.error(O("expected value %s",m.val),a)),M)if(m&&m.silent){this.pos=a.pos;return}else throw M;else return a},P.prototype.error=function(m,a){var w=typeof a!="number",j=w?a.pos:a,z=this._str,ee=1,M=0,G;for(G=0;G<j;G++)z.charAt(G)===`
`&&(ee++,M=G);var D=w?O("invalid token %j: %s",a,m):m,Q=new Error(D);return Q.token=w?a:void 0,Q.lineNum=ee,Q.colNum=j-M,Q},P.prototype._skip=function(m){for(var a=this._str,w=!1,j,z;(z=a.charAt(this.pos))&&/\s/.test(z);)this.pos++;if(j=this.pos,z==="/")switch(a.charAt(this.pos+1)){case"/":for(this.pos+=2;(z=a.charAt(this.pos))&&z!==`
`;)this.pos++;return this._skip(m);case"*":for(this.pos+=2,a.charAt(this.pos)==="*"&&(w=!0);z=a.charAt(this.pos++);)if(z==="*"&&a.charAt(this.pos)==="/")return this.pos++,w&&m?Y(a.slice(j+3,this.pos-2)):this._skip(m);throw this.error("unterminated comment",j)}},P.prototype._endOf=function(m){for(var a=this.pos,w=this._str;m.test(w.charAt(a));)a++;return a},P.prototype._endOfString=function(){for(var m=this.pos+1,a=this._str,w;w=a.charAt(m);){if(w==='"')return m+1;w==="\\"?m+=2:m++}throw this.error("unterminated string",m-1)},P.prototype._endOfJson=function(){var m=d.jsonEnd(this._str,this.pos);if(m<0)throw this.error("invalid JSON",m);return m};function Y(m){for(var a=m.replace(/^[ \t]+|[ \t]+$/g,"").split(`
`).map(function(w,j){return j?w.replace(/^\s*\*\s?/,""):w});a.length&&!a[0];)a.shift();for(;a.length&&!a[a.length-1];)a.pop();return a.join(`
`)}function te(m){if(m.namespace)return m.namespace;var a=/^(.*)\.[^.]+$/.exec(m.protocol);return a?a[1]:void 0}l.exports={Tokenizer:P,assembleProtocol:v,read:R,readProtocol:$.readProtocol,readSchema:$.readSchema}}}),Ht=Ie({"node_modules/avsc/lib/index.js"(u,l){"use strict";var h=Dt(),d=jt(),_=Mt(),g=ot(),O=ze(),T=Ue,v=mt,R=De,$=T.Buffer;function P(a,w){var j=_.read(a);return j.protocol?d.Service.forProtocol(j,w):g.Type.forSchema(j,w)}function Y(a,w){w=w||{};var j=w.decode===void 0?!0:!!w.decode,z=Math.max(w.size||4096,4),ee=O.newBuffer(z),M=v.openSync(a,"r");try{var G=v.readSync(M,ee,0,z);if(G<4||!h.MAGIC_BYTES.equals(ee.slice(0,4)))return null;var D=new O.Tap(ee),Q=null;do Q=h.HEADER_TYPE._read(D);while(!ne());if(j!==!1){var q=Q.meta;q["avro.schema"]=JSON.parse(q["avro.schema"].toString()),q["avro.codec"]!==void 0&&(q["avro.codec"]=q["avro.codec"].toString())}return Q}finally{v.closeSync(M)}function ne(){if(D.isValid())return!0;var E=2*D.buf.length,S=O.newBuffer(E);return E=v.readSync(M,S,0,E),D.buf=$.concat([D.buf,S]),D.pos=0,!1}}function te(a,w){return v.createReadStream(a).pipe(new h.streams.BlockDecoder(w))}function m(a,w,j){var z=new h.streams.BlockEncoder(w,j);return z.pipe(v.createWriteStream(a,{defaultEncoding:"binary"})),z}l.exports={Service:d.Service,Type:g.Type,assembleProtocol:_.assembleProtocol,createFileDecoder:te,createFileEncoder:m,discoverProtocol:d.discoverProtocol,extractFileHeader:Y,parse:P,readProtocol:_.readProtocol,readSchema:_.readSchema,streams:h.streams,types:g.builtins,Protocol:d.Service,assemble:R.deprecate(_.assembleProtocol,"use `assembleProtocol` instead"),combine:R.deprecate(g.Type.forTypes,"use `Type.forTypes` intead"),infer:R.deprecate(g.Type.forValue,"use `Type.forValue` instead")}}}),at="AWS4-HMAC-SHA256",Xe="aws4_request",Ze="s3",Vt="2",_e="UNSIGNED-PAYLOAD",qt="application/octet-stream",et="application/xml",Ne="application/json",Ut=["accessKeyId","secretAccessKey","sessionToken","password"],de="x-amz-content-sha256",zt="x-amz-date",Gt="host",Kt="Authorization",Ee="Content-Type",Ae="Content-Length",ut="etag",ct="last-modified",oe="ultralight-s3 Module: ",Jt=`${oe}accessKeyId must be a non-empty string`,Wt=`${oe}secretAccessKey must be a non-empty string`,Yt=`${oe}endpoint must be a non-empty string`,Qt=`${oe}bucketName must be a non-empty string`,ht=`${oe}key must be a non-empty string`,Pe=`${oe}uploadId must be a non-empty string`,ft=`${oe}parts must be a non-empty array`,lt=`${oe}Each part must have a partNumber (number) and ETag (string)`,We=`${oe}data must be a Buffer or string`,pt=`${oe}prefix must be a string`,dt=`${oe}maxKeys must be a positive integer`,yt=`${oe}delimiter must be a string`,Et=crypto.createHmac||(await import("node:crypto")).createHmac,Tt=crypto.createHash||(await import("node:crypto")).createHash;typeof Et>"u"&&typeof Tt>"u"&&console.error("ultralight-S3 Module: Crypto functions are not available, please report the issue with necessary description: https://github.com/sentienhq/ultralight-s3/issues");var Xt={contents:!0},Zt=u=>`%${u.charCodeAt(0).toString(16).toUpperCase()}`,it=u=>encodeURIComponent(u).replace(/[!'()*]/g,Zt),me=u=>it(u).replace(/%2F/g,"/"),er=class{constructor({accessKeyId:u,secretAccessKey:l,endpoint:h,bucketName:d,region:_="auto",maxRequestSizeInBytes:g=5242880,requestAbortTimeout:O=void 0,logger:T=void 0}){this.getBucketName=()=>this.bucketName,this.setBucketName=v=>{this.bucketName=v},this.getRegion=()=>this.region,this.setRegion=v=>{this.region=v},this.getEndpoint=()=>this.endpoint,this.setEndpoint=v=>{this.endpoint=v},this.getMaxRequestSizeInBytes=()=>this.maxRequestSizeInBytes,this.setMaxRequestSizeInBytes=v=>{this.maxRequestSizeInBytes=v},this.sanitizeETag=v=>Ve(v),this.getProps=()=>({accessKeyId:this.accessKeyId,secretAccessKey:this.secretAccessKey,region:this.region,bucket:this.bucketName,endpoint:this.endpoint,maxRequestSizeInBytes:this.maxRequestSizeInBytes,requestAbortTimeout:this.requestAbortTimeout,logger:this.logger}),this.setProps=v=>{this._validateConstructorParams(v.accessKeyId,v.secretAccessKey,v.bucketName,v.endpoint),this.accessKeyId=v.accessKeyId,this.secretAccessKey=v.secretAccessKey,this.region=v.region||"auto",this.bucketName=v.bucketName,this.endpoint=v.endpoint,this.maxRequestSizeInBytes=v.maxRequestSizeInBytes||5242880,this.requestAbortTimeout=v.requestAbortTimeout,this.logger=v.logger},this._validateConstructorParams(u,l,h,d),this.accessKeyId=u,this.secretAccessKey=l,this.endpoint=h,this.bucketName=d,this.region=_,this.maxRequestSizeInBytes=g,this.requestAbortTimeout=O,this.logger=T}_validateConstructorParams(u,l,h,d){if(typeof u!="string"||u.trim().length===0)throw new TypeError(Jt);if(typeof l!="string"||l.trim().length===0)throw new TypeError(Wt);if(typeof h!="string"||h.trim().length===0)throw new TypeError(Yt);if(typeof d!="string"||d.trim().length===0)throw new TypeError(Qt)}_checkMethodHeadnGet(u){if(u!=="GET"&&u!=="HEAD")throw this._log("error",`${oe}method must be either GET or HEAD`),new Error("method must be either GET or HEAD")}_checkKey(u){if(typeof u!="string"||u.trim().length===0)throw this._log("error",ht),new TypeError(ht)}_checkDelimiter(u){if(typeof u!="string"||u.trim().length===0)throw this._log("error",yt),new TypeError(yt)}_checkPrefix(u){if(typeof u!="string")throw this._log("error",pt),new TypeError(pt)}_checkMaxKeys(u){if(typeof u!="number"||u<=0)throw this._log("error",dt),new TypeError(dt)}_checkOpts(u){if(typeof u!="object")throw this._log("error",`${oe}opts must be an object`),new TypeError(`${oe}opts must be an object`)}_log(u,l,h={}){if(this.logger&&typeof this.logger[u]=="function"){let d=O=>typeof O!="object"||O===null?O:Object.keys(O).reduce((T,v)=>(Ut.includes(v.toLowerCase())?T[v]="[REDACTED]":typeof O[v]=="object"&&O[v]!==null?T[v]=d(O[v]):T[v]=O[v],T),Array.isArray(O)?[]:{}),_=d(h),g={timestamp:new Date().toISOString(),level:u,message:l,..._,context:d({bucketName:this.bucketName,region:this.region,endpoint:this.endpoint,accessKeyId:this.accessKeyId?`${this.accessKeyId.substring(0,4)}...`:void 0})};this.logger[u](g)}}async getContentLength(u){this._checkKey(u);let l={[de]:_e},h=me(u),{url:d,headers:_}=await this._sign("HEAD",h,{},l,""),g=(await this._sendRequest(d,"HEAD",_)).headers.get(Ae);return g?parseInt(g,10):0}async bucketExists(){let u={[de]:_e},{url:l,headers:h}=await this._sign("HEAD","",{},u,""),d=await this._sendRequest(l,"HEAD",h,"",[200,404,403]);return this._log("error",`Response status: ${d.status,d.statusText}`),!!(d.ok&&d.status===200)}async createBucket(){let u=`
    <CreateBucketConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
      <LocationConstraint>${this.region}</LocationConstraint>
    </CreateBucketConfiguration>
    `,l={[Ee]:et,[Ae]:Buffer.byteLength(u).toString(),[de]:await Me(u)},h=encodeURI(""),{url:d,headers:_}=await this._sign("PUT",h,{},l,""),g=await this._sendRequest(d,"PUT",_,u,[200,404,403]);return!!(g.ok&&g.status===200)}async fileExists(u,l={}){this._checkKey(u);let{filteredOpts:h,conditionalHeaders:d}=this._filterIfHeaders(l),_={[de]:_e,...d},g=me(u),{url:O,headers:T}=await this._sign("HEAD",g,h,_,"");try{let v=await this._sendRequest(O,"HEAD",T,"",[200,404,412,304]);return v.status===404?!1:v.status===412||v.status===304?null:v.ok&&v.status===200?!0:(this._handleErrorResponse(v),!1)}catch(v){let R=v instanceof Error?v.message:String(v);throw this._log("error",`${oe}Failed to check if file exists: ${R}`),new Error(`${oe}Failed to check if file exists: ${R}`)}}async _sign(u,l,h={},d,_){let g=new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),O=typeof l=="string"&&l.length>0?new URL(l,this.endpoint):new URL(this.endpoint);O.pathname=`/${encodeURI(this.bucketName)}${O.pathname}`,d[de]=_?await Me(_):_e,d[zt]=g,d[Gt]=O.host;let T=this._buildCanonicalHeaders(d),v=Object.keys(d).map(te=>te.toLowerCase()).sort().join(";"),R=await this._buildCanonicalRequest(u,O,h,T,v,_),$=await this._buildStringToSign(g,R),P=await this._calculateSignature(g,$),Y=this._buildAuthorizationHeader(g,v,P);return d[Kt]=Y,{url:O.toString(),headers:d}}_buildCanonicalHeaders(u){return Object.entries(u).map(([l,h])=>`${l.toLowerCase()}:${String(h).trim()}`).sort().join(`
`)}async _buildCanonicalRequest(u,l,h,d,_,g){return[u,l.pathname,this._buildCanonicalQueryString(h),`${d}
`,_,g?await Me(g):_e].join(`
`)}async _buildStringToSign(u,l){let h=[u.slice(0,8),this.region,Ze,Xe].join("/");return[at,u,h,await Me(l)].join(`
`)}async _calculateSignature(u,l){let h=await this._getSignatureKey(u.slice(0,8));return He(h,l,"hex")}_buildAuthorizationHeader(u,l,h){let d=[u.slice(0,8),this.region,Ze,Xe].join("/");return[`${at} Credential=${this.accessKeyId}/${d}`,`SignedHeaders=${l}`,`Signature=${h}`].join(", ")}_filterIfHeaders(u){let l={},h={},d=["if-match","if-none-match","if-modified-since","if-unmodified-since"];for(let[_,g]of Object.entries(u))d.includes(_)?h[_]=g:l[_]=g;return{filteredOpts:l,conditionalHeaders:h}}async list(u="/",l="",h=1e3,d="GET",_={}){this._checkDelimiter(u),this._checkPrefix(l),this._checkMaxKeys(h),this._checkMethodHeadnGet(d),this._checkOpts(_),this._log("info",`Listing objects in ${l}`);let g={"list-type":Vt,"max-keys":String(h),..._};l.length>0&&(g.prefix=l);let O={[Ee]:Ne,[de]:_e},T=u==="/"?u:it(u),{url:v,headers:R}=await this._sign("GET",T,g,O,""),$=`${v}?${new URLSearchParams(g)}`,P=await this._sendRequest($,"GET",R),Y=await P.text();if(d==="HEAD"){let a=P.headers.get(Ae),w=P.headers.get(ct),j=P.headers.get(ut);return{size:a?+a:void 0,mtime:w?new Date(w):void 0,ETag:j||void 0}}let te=Be(Y),m=te.listBucketResult||te.error||te;return m.contents||m}async listMultiPartUploads(u="/",l="",h="GET",d={}){var _,g,O;this._checkDelimiter(u),this._checkPrefix(l),this._checkMethodHeadnGet(h),this._checkOpts(d),this._log("info",`Listing multipart uploads in ${l}`);let T={uploads:"",...d},v={[Ee]:Ne,[de]:_e},R=u==="/"?u:it(u),{url:$,headers:P}=await this._sign("GET",R,T,v,""),Y=`${$}?${new URLSearchParams(T)}`,te=await this._sendRequest(Y,"GET",P),m=await te.text();if(h==="HEAD")return{size:+((_=te.headers.get(Ae))!==null&&_!==void 0?_:"0"),mtime:new Date((g=te.headers.get(ct))!==null&&g!==void 0?g:""),ETag:(O=te.headers.get(ut))!==null&&O!==void 0?O:""};let a=Be(m),w=a.listMultipartUploadsResult||a.error||a;return w.uploads||w}async get(u,l={}){this._checkKey(u),this._log("info",`Getting object ${u}`);let{filteredOpts:h,conditionalHeaders:d}=this._filterIfHeaders(l),_={[Ee]:Ne,[de]:_e,...d},g=me(u),{url:O,headers:T}=await this._sign("GET",g,h,_,""),v=await this._sendRequest(O,"GET",T,"",[200,404,412,304]);if(v.status===404||v.status===412||v.status===304)return this._log("error",`Failed to get object. Status: ${v.status}`),null;if(!v.ok)throw this._log("error",`Failed to get object. Status: ${v.status}`),new Error(`Failed to get object. Status: ${v.status}`);return v}async getObjectWithETag(u,l={}){this._checkKey(u),this._log("info",`Getting object ${u}`);let{filteredOpts:h,conditionalHeaders:d}=this._filterIfHeaders(l),_={[Ee]:Ne,[de]:_e,...d},g=me(u),{url:O,headers:T}=await this._sign("GET",g,h,_,"");try{let v=await this._sendRequest(O,"GET",T,"",[200,404,412,304]);if(v.status===404||v.status===412||v.status===304)return this._log("error",`Failed to get object. Status: ${v.status}`),{etag:null,data:null};if(!v.ok)throw this._log("error",`Failed to get object. Status: ${v.status}`),new Error(`Failed to get object. Status: ${v.status}`);let R=v.headers.get("etag");if(!R)throw new Error("ETag not found in response headers");let $=await v.text();return{etag:Ve(R),data:$}}catch(v){throw this._log("error",`Error getting object ${u} with ETag: ${v}`),v}}async getEtag(u,l={}){this._checkKey(u),this._log("info",`Getting etag object ${u}`);let{filteredOpts:h,conditionalHeaders:d}=this._filterIfHeaders(l),_={[Ee]:Ne,[de]:_e,...d},g=me(u),{url:O,headers:T}=await this._sign("HEAD",g,h,_,""),v=await this._sendRequest(O,"HEAD",T,"",[200,412,304]);if(this._log("info",`Response status: ${v.status,v.statusText}`),v.status===412||v.status===304)return null;let R=v.headers.get("etag");if(!R)throw this._log("error","ETag not found in response headers"),new Error("ETag not found in response headers");return Ve(R)}async getResponse(u,l=!0,h=0,d=this.maxRequestSizeInBytes,_={}){this._checkKey(u);let{filteredOpts:g,conditionalHeaders:O}=this._filterIfHeaders({..._}),T={[Ee]:Ne,[de]:_e,...l?{}:{range:`bytes=${h}-${d-1}`},...O},v=me(u),{url:R,headers:$}=await this._sign("GET",v,g,T,""),P=`${R}?${new URLSearchParams(g)}`;return this._sendRequest(P,"GET",$)}async put(u,l){if(this._checkKey(u),!(l instanceof Buffer||typeof l=="string"))throw this._log("error",We),new TypeError(We);this._log("info",`Uploading object ${u}`);let h=typeof l=="string"?Buffer.byteLength(l):l.length,d={[Ae]:h},_=me(u),{url:g,headers:O}=await this._sign("PUT",_,{},d,l);return this._sendRequest(g,"PUT",O,l,[200])}async getMultipartUploadId(u,l=qt){if(this._checkKey(u),typeof l!="string")throw this._log("error",`${oe}fileType must be a string`),new TypeError(`${oe}fileType must be a string`);this._log("info",`Initiating multipart upload for object ${u}`);let h={uploads:""},d={[Ee]:l,[de]:_e},_=me(u),{url:g,headers:O}=await this._sign("POST",_,h,d,""),T=`${g}?${new URLSearchParams(h)}`,v=await(await this._sendRequest(T,"POST",O)).text(),R=Be(v);if(typeof R=="object"&&R!==null&&"error"in R&&typeof R.error=="object"&&R.error!==null&&"message"in R.error){let $=String(R.error.message);throw this._log("error",`${oe}Failed to abort multipart upload: ${$}`),new Error(`${oe}Failed to abort multipart upload: ${$}`)}if(typeof R=="object"&&R!==null){if(!R.initiateMultipartUploadResult||!R.initiateMultipartUploadResult.uploadId)throw this._log("error",`${oe}Failed to create multipart upload: no uploadId in response`),new Error(`${oe}Failed to create multipart upload: Missing upload ID in response`);return R.initiateMultipartUploadResult.uploadId}else throw this._log("error",`${oe}Failed to create multipart upload: unexpected response format`),new Error(`${oe}Failed to create multipart upload: Unexpected response format`)}async uploadPart(u,l,h,d,_={}){this._validateUploadPartParams(u,l,h,d,_);let g={uploadId:h,partNumber:d,..._},O={[Ae]:l.length},T=me(u),{url:v,headers:R}=await this._sign("PUT",T,g,O,l),$=`${v}?${new URLSearchParams(g)}`,P=await this._sendRequest($,"PUT",R,l),Y=Ve(P.headers.get("etag")||"");return{partNumber:d,ETag:Y}}_validateUploadPartParams(u,l,h,d,_){if(this._checkKey(u),!(l instanceof Buffer||typeof l=="string"))throw this._log("error",We),new TypeError(We);if(typeof h!="string"||h.trim().length===0)throw this._log("error",Pe),new TypeError(Pe);if(!Number.isInteger(d)||d<=0)throw this._log("error",`${oe}partNumber must be a positive integer`),new TypeError(`${oe}partNumber must be a positive integer`);this._checkOpts(_)}async completeMultipartUpload(u,l,h){if(this._checkKey(u),typeof l!="string"||l.trim().length===0)throw this._log("error",Pe),new TypeError(Pe);if(!Array.isArray(h)||h.length===0)throw this._log("error",ft),new TypeError(ft);if(!h.every(Y=>typeof Y.partNumber=="number"&&typeof Y.ETag=="string"))throw this._log("error",lt),new TypeError(lt);this._log("info",`Complete multipart upload ${l} for object ${u}`);let d={uploadId:l},_=this._buildCompleteMultipartUploadXml(h),g={[Ee]:et,[Ae]:Buffer.byteLength(_).toString(),[de]:await Me(_)},O=me(u),{url:T,headers:v}=await this._sign("POST",O,d,g,_),R=`${T}?${new URLSearchParams(d)}`,$=await(await this._sendRequest(R,"POST",v,_)).text(),P=Be($);if(typeof P=="object"&&P!==null&&"error"in P&&typeof P.error=="object"&&P.error!==null&&"message"in P.error){let Y=String(P.error.message);throw this._log("error",`${oe}Failed to abort multipart upload: ${Y}`),new Error(`${oe}Failed to abort multipart upload: ${Y}`)}return P.completeMultipartUploadResult}async abortMultipartUpload(u,l){if(this._checkKey(u),typeof l!="string"||l.trim().length===0)throw this._log("error",Pe),new TypeError(Pe);this._log("info",`Aborting multipart upload ${l} for object ${u}`);let h={uploadId:l},d={[Ee]:et,[de]:_e};try{let _=me(u),{url:g,headers:O}=await this._sign("DELETE",_,h,d,""),T=`${g}?${new URLSearchParams(h)}`,v=await this._sendRequest(T,"DELETE",O);if(v.ok){let R=await v.text(),$=Be(R);if(typeof $=="object"&&$!==null&&"error"in $&&typeof $.error=="object"&&$.error!==null&&"message"in $.error){let P=String($.error.message);throw this._log("error",`${oe}Failed to abort multipart upload: ${P}`),new Error(`${oe}Failed to abort multipart upload: ${P}`)}return{status:"Aborted",key:u,uploadId:l,response:$}}else throw this._log("error",`${oe}Abort request failed with status ${v.status}`),new Error(`${oe}Abort request failed with status ${v.status}`)}catch(_){let g=_ instanceof Error?_.message:String(_);throw this._log("error",`${oe}Failed to abort multipart upload for key ${u}: ${g}`),new Error(`${oe}Failed to abort multipart upload for key ${u}: ${g}`)}}_buildCompleteMultipartUploadXml(u){return`
      <CompleteMultipartUpload>
        ${u.map(l=>`
          <Part>
            <PartNumber>${l.partNumber}</PartNumber>
            <ETag>${l.ETag}</ETag>
          </Part>
        `).join("")}
      </CompleteMultipartUpload>
    `}async delete(u){this._checkKey(u),this._log("info",`Deleting object ${u}`);let l={[Ee]:Ne,[de]:_e},h=me(u),{url:d,headers:_}=await this._sign("DELETE",h,{},l,""),g=await this._sendRequest(d,"DELETE",_);return g.status===204||g.status===200}async _sendRequest(u,l,h,d,_=[]){this._log("info",`Sending ${l} request to ${u}, headers: ${JSON.stringify(h)}`);let g=await fetch(u,{method:l,headers:h,body:["GET","HEAD"].includes(l)?void 0:d,signal:this.requestAbortTimeout!==void 0?AbortSignal.timeout(this.requestAbortTimeout):void 0});return this._log("info",`Response status: ${g.status,_}`),!g.ok&&!_.includes(g.status)&&await this._handleErrorResponse(g),g}async _handleErrorResponse(u){let l=await u.text(),h=u.headers.get("x-amz-error-code")||"Unknown",d=u.headers.get("x-amz-error-message")||u.statusText;throw this._log("error",`${oe}Request failed with status ${u.status}: ${h} - ${d},err body: ${l}`),new Error(`${oe}Request failed with status ${u.status}: ${h} - ${d}, err body: ${l}`)}_buildCanonicalQueryString(u){return Object.keys(u).length<1?"":Object.keys(u).sort().map(l=>`${encodeURIComponent(l)}=${encodeURIComponent(u[l])}`).join("&")}async _getSignatureKey(u){let l=await He(`AWS4${this.secretAccessKey}`,u),h=await He(l,this.region),d=await He(h,Ze);return He(d,Xe)}},Me=async u=>{let l=Tt("sha256");return l.update(u),l.digest("hex")},He=async(u,l,h)=>{let d=Et("sha256",u);return d.update(l),d.digest(h)},Ve=u=>{let l={'"':"","&quot;":"","&#34;":"","&QUOT;":"","&#x00022":""};return u.replace(/^("|&quot;|&#34;)|("|&quot;|&#34;)$/g,h=>l[h])},Be=u=>{let l=g=>g.replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),h={},d=/<(\w)([-\w]+)(?:\/|[^>]*>((?:(?!<\1)[\s\S])*)<\/\1\2)>/gm,_;for(;_=d.exec(u);){let[,g,O,T]=_,v=g.toLowerCase()+O,R=T!=null?Be(T):!0;typeof R=="string"?h[v]=Ve(l(R)):Array.isArray(h[v])?h[v].push(R):h[v]=h[v]!=null?[h[v],R]:Xt[v]?[R]:R}return Object.keys(h).length?h:l(u)},Ot=Lt(Ht(),1),U={MISSING_ARGUMENT:"MISSING_ARGUMENT",COLLECTION_EXISTS:"COLLECTION_EXISTS",CREATE_COLLECTION_ERROR:"CREATE_COLLECTION_ERROR",LIST_COLLECTIONS_ERROR:"LIST_COLLECTIONS_ERROR",RENAME_COLLECTION_ERROR:"RENAME_COLLECTION_ERROR",REMOVE_COLLECTION_ERROR:"REMOVE_COLLECTION_ERROR",UPDATE_COLLECTION_SCHEMA_ERROR:"UPDATE_COLLECTION_SCHEMA_ERROR",COLLECTION_NOT_FOUND:"COLLECTION_NOT_FOUND",SCHEMA_VALIDATION_ERROR:"SCHEMA_VALIDATION_ERROR",DOCUMENT_VALIDATION_ERROR:"DOCUMENT_VALIDATION_ERROR",S3_OPERATION_ERROR:"S3_OPERATION_ERROR",FIND_ERROR:"FIND_ERROR",FIND_ONE_ERROR:"FIND_ONE_ERROR",SAVE_DATA_ERROR:"SAVE_DATA_ERROR",INSERT_ERROR:"INSERT_ERROR",UPDATE_ERROR:"UPDATE_ERROR",UPDATE_ONE_ERROR:"UPDATE_ONE_ERROR",DELETE_ERROR:"DELETE_ERROR",COUNT_ERROR:"COUNT_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"},re=class extends Error{constructor(u,l=U.UNKNOWN_ERROR){super(`lowstorageError: ${u} :: code: ${l}`),this.name=this.constructor.name,this.code=l,Error.captureStackTrace(this,this.constructor)}},Se=class extends re{constructor(u,l=U.SCHEMA_VALIDATION_ERROR){super(u,U.SCHEMA_VALIDATION_ERROR)}},Le=class extends re{constructor(u,l=U.DOCUMENT_VALIDATION_ERROR){super(u,U.DOCUMENT_VALIDATION_ERROR)}},le=class extends re{constructor(u,l){super(`S3 ${l} operation failed: ${u}`,U.S3_OPERATION_ERROR)}},Ye=(u,l)=>Object.keys(l).every(h=>u[h]===l[h]),tr=async()=>typeof tt<"u"&&typeof tt=="function"?tt():typeof crypto<"u"&&typeof crypto=="object"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var l=Math.random()*16|0,h=u==="x"?l:l&3|8;return h.toString(16)}),Qe=u=>{let l={name:"_id",type:"string",size:16,logicalType:"UUID"};return(typeof u>"u"||u===null)&&(typeof u!="object"||!Array.isArray(u))||("type"in u&&u.type==="record"&&"fields"in u&&Array.isArray(u.fields)?u.fields.some(d=>d.name==="_id")||u.fields.unshift(l):"type"in u&&u.type==="array"&&"items"in u&&u.items!==null&&typeof u.items=="object"&&"type"in u.items&&u.items.type==="record"&&"fields"in u.items&&Array.isArray(u.items.fields)&&(u.items.fields.some(d=>d.name==="_id")||u.items.fields.unshift(l))),u},fe="lowstorage",Oe="/",Rt="lowstorage",Re=".avro",rr=1024*1024,_t=5*rr,nt=Buffer.from("","utf8"),rt=(u=U.DOCUMENT_VALIDATION_ERROR)=>{throw new Le(`${fe}: Invalid document or schema ${u}`)},qe=(u="")=>{if(u.trim()===""||u===null||typeof u>"u"||u.length>255)throw new re("Collection name is required, null or too long",U.MISSING_ARGUMENT)},yr=class{constructor(u){this._checkArgs=l=>{let h=["accessKeyId","secretAccessKey","endpoint","bucketName"];for(let d of h)if(!l[d])throw new re(`${d} is required`,U.MISSING_ARGUMENT)},this.s3=()=>this._s3,this._checkArgs(u),this._schemas=new Map,this._s3=new er(u),this._dirPrefix=u.dirPrefix||Rt,this._avroParse=Ot.Type}async checkIfStorageExists(){try{return!!await this._s3.bucketExists()}catch(u){if(u.message.includes("Not Found"))return!1;throw new re(`${u.message}`,U.S3_OPERATION_ERROR)}}async createStorage(){try{let u=await this.checkIfStorageExists();return u||!!await this._s3.createBucket()}catch(u){throw u instanceof re?u:new re(`${u.message}`,U.S3_OPERATION_ERROR)}}async listCollections(){try{let u=await this._s3.list(Oe,this._dirPrefix);return Array.isArray(u)?u.map(l=>l.key.slice(this._dirPrefix.length+1,-Re.length)):typeof u=="object"&&u!==null&&"keyCount"in u&&u.keyCount==="0"?[]:[]}catch(u){throw u instanceof le?u:new re(`${u.message}`,U.LIST_COLLECTIONS_ERROR)}}async collectionExists(u=""){try{return qe(u),!!await this._s3.fileExists(`${this._dirPrefix}${Oe}${u}${Re}`)}catch(l){if(l.message.includes("Not Found"))return!1;throw new re(`${l.message}`,U.COLLECTION_NOT_FOUND)}}async createCollection(u="",l,h=[]){try{if(qe(u),!await this.collectionExists(u)){if(typeof l<"u"&&l!==null)try{if(this._avroParse.forSchema(l))this._schemas.set(u,l);else throw new Se(`Schema is invalid: ${l}`,U.SCHEMA_VALIDATION_ERROR)}catch(_){throw new Se(`Schema is invalid: ${_.message} in ${l} `,U.SCHEMA_VALIDATION_ERROR)}if(h.length>0&&l){let _=this._avroParse.forSchema({type:"array",items:l});await this._s3.put(`${this._dirPrefix}${Oe}${u}${Re}`,_.toBuffer(h))}else await this._s3.put(`${this._dirPrefix}${Oe}${u}${Re}`,nt);return this.collection(u,l,!1)}throw new re(`Collection ${u} already exists`,U.COLLECTION_EXISTS)}catch(d){throw d instanceof Se?d:new re(`${d.message}`,U.CREATE_COLLECTION_ERROR)}}async removeCollection(u=""){try{if(qe(u),await this.collectionExists(u)){await this._s3.delete(`${this._dirPrefix}${Oe}${u}${Re}`);let h=await this.collectionExists(u);if(typeof h=="boolean"){if(!h)return this._schemas.delete(u),!0;throw new re(`Failed to delete collection ${u}`,U.S3_OPERATION_ERROR)}throw new le(`${fe}: Failed to delete collection ${u}`,U.S3_OPERATION_ERROR)}throw new re(`Collection ${u} does not exist`,U.REMOVE_COLLECTION_ERROR)}catch(l){throw l instanceof le?l:new re(`Failed to remove collection: ${l.message}`,U.REMOVE_COLLECTION_ERROR)}}async collection(u="",l,h=!0){try{qe(u);let d=`${this._dirPrefix}${Oe}${u}${Re}`;if(!await this._s3.fileExists(d)){if(!h)throw new re(`Collection ${u} does not exist`,U.COLLECTION_NOT_FOUND);await this._s3.put(d,nt)}let g=l||this._schemas.get(u)||void 0;return new ir(u,g,this._s3,this._dirPrefix)}catch(d){throw d.message.includes("unknown type")?new Se(`Schema input is invalid: ${d.message}`,U.SCHEMA_VALIDATION_ERROR):d instanceof re?d:new re(`${d.message}`,U.COLLECTION_NOT_FOUND)}}},ir=class St{constructor(l="",h,d,_=Rt,g=!1,O=_t){this.getProps=()=>({colName:this._colName,s3:this._s3,schema:this._schema,avroParse:this._avroParse,avroType:this._avroType,dirPrefix:this._dirPrefix,safeWrite:this._safeWrite,chunkSize:this._chunkSize}),this.setProps=T=>{this._colName=T.colName,this._schema=T.schema,this._s3=T.s3,this._avroParse=T.avroParse,this._avroType=T.avroType,this._dirPrefix=T.dirPrefix,this._safeWrite=T.safeWrite,this._chunkSize=T.chunkSize},this.setSafeWrite=T=>{this._safeWrite=T},this.getSafeWrite=()=>this._safeWrite,this.getAvroSchema=()=>this._schema,this.setAvroSchema=T=>{try{this._schema=Qe(T),this._avroType=typeof T>"u"?null:this._avroParse.forSchema(T)}catch(v){throw new Se(`Schema is invalid: ${v.message}`,U.SCHEMA_VALIDATION_ERROR)}},this.getCollectionETag=()=>this._lastETag,this.inferAvroSchema=(T,v="record")=>{Array.isArray(T)&&(T=T[0]);let $=this._avroParse.forValue(T).schema();return Qe($)},this._colName=l.trim(),this._s3=d,this._schema=Qe(h),this._dirPrefix=_,this._safeWrite=g,this._chunkSize=O||_t,this._s3.setMaxRequestSizeInBytes(this._chunkSize),this._avroParse=Ot.Type,this._lastETag="",this._dataCache=[],this._avroType=typeof h>"u"?null:this._avroParse.forSchema(h),this._key=`${this._dirPrefix}${Oe}${this._colName}${Re}`}async forceLoadData(){try{this._lastETag="";let l=await this._loadData();return this._dataCache=l,!0}catch(l){throw new re(`Failed to force update data: ${l.message}`,U.S3_OPERATION_ERROR)}}async _loadData(){try{if(this._avroType===null||typeof this._avroType>"u")throw new re("Missing type definition. Configure before operations ",U.SCHEMA_VALIDATION_ERROR);let{etag:l,data:h}=await this._s3.getObjectWithETag(this._key,{"if-none-match":this._lastETag});if(h===null)return this._dataCache;this._lastETag=l===null?this._lastETag:l;let d=this._avroParse.forSchema({type:"array",items:this._avroType});if(h.length<this._chunkSize)return this._dataCache=h.length>0?d.fromBuffer(Buffer.from(h,"utf8")):[],this._dataCache;let _=this._chunkSize,g=[Buffer.from(h,"utf8")],O=!0;for(;O;){let v=await this._s3.getResponse(this._key,!1,_,_+this._chunkSize),R=await v.text();g.push(Buffer.from(R,"utf8")),_+=this._chunkSize,parseInt(v.headers.get("content-length")||R.length.toString())<this._chunkSize&&(O=!1)}let T=Buffer.concat(g);return this._dataCache=d.fromBuffer(T),this._dataCache}catch(l){if(l.toString().indexOf("status 404: Unknown - Not Found")>-1)return this._dataCache=[],this._dataCache;throw new le(`${fe}: Failed to load data: ${l.message}`,U.S3_OPERATION_ERROR)}}async _saveData(l){try{if(this._avroType===null||typeof this._avroType>"u")throw new re("Missing type definition. Configure before operations ",U.SCHEMA_VALIDATION_ERROR);let h=this._avroParse.forSchema({type:"array",items:this._avroType}),d=l.length>0?h.toBuffer(l):nt;if(this._safeWrite&&this._lastETag!==""){let O=await this._s3.getEtag(this._key);if(O!==null&&O!==this._lastETag)return!1}let _=await this._s3.put(this._key,d);if(typeof _=="object"&&"status"in _&&_.status!==200)throw new le(`${fe}: Failed to save data`,U.S3_OPERATION_ERROR);let g=_.headers?.get("etag")||"";return g&&g.length>0&&(this._lastETag=this._s3.sanitizeETag(g),this._dataCache=l),!0}catch(h){throw h instanceof le||h instanceof re?h:new re(`${h.message}`,U.SAVE_DATA_ERROR)}}async insert(l,h){try{if(l==null)throw new re("Document is required for insert",U.INSERT_ERROR);if(typeof l!="object"&&!Array.isArray(l))throw new Le(`${fe}: Document must be an object or an array`,U.DOCUMENT_VALIDATION_ERROR);let d=Array.isArray(l)?l:[l],_=h?Qe(h):this._schema||this.inferAvroSchema(d[0]),g=this._avroParse.forSchema(_);if(!g)throw new Se("Schema is required - Pass a schema to the insert method",U.SCHEMA_VALIDATION_ERROR);this._avroType=g;let O=await this._loadData();for(let v of d){if(typeof v!="object"||v===null)throw new Le(`${fe}: Invalid input: input must be an object or an array of objects`,U.DOCUMENT_VALIDATION_ERROR);if(v._id=v._id||await tr(),this._avroType.isValid(v,{errorHook:rt,noUndeclaredFields:!0})===!0)O.push(v);else throw new Le(`${fe}: Invalid document or schema`,U.DOCUMENT_VALIDATION_ERROR)}if(!await this._saveData(O))throw new le(`${fe}: Failed to insert document`,U.S3_OPERATION_ERROR);return this.setAvroSchema(_),d}catch(d){throw d.message.includes("unknown type")?new Se(`Schema input is invalid: ${d.message}`,U.SCHEMA_VALIDATION_ERROR):d instanceof re?d:new re(`Insert operation failed: ${d.message}`,U.INSERT_ERROR)}}async find(l={},h={}){try{if(l==null)throw new re("Query is required for update",U.MISSING_ARGUMENT);let d=await this._loadData(),_=h.skip!==void 0?parseInt(String(h.skip),10):0,g=h.limit!==void 0?_+parseInt(String(h.limit),10):void 0;return d.filter(T=>Ye(T,l)).slice(_,g)}catch(d){throw new re(`Find operation failed: ${d.message}`,U.FIND_ERROR)}}async findOne(l={}){try{if(l===null)throw new re(`${fe}: Query cannot be null`,U.INVALID_ARGUMENT);return(await this.find(l,{limit:1}))[0]||null}catch(h){throw h instanceof re?h:new re(`${fe}: FindOne operation failed: ${h.message}`,U.FIND_ONE_ERROR)}}async update(l={},h={},d={}){try{if(l==null||h===void 0||h===null)throw new re("Query and update values are required for update",U.MISSING_ARGUMENT);if(!this._avroType)throw new Se("Schema is not defined for this collection",U.SCHEMA_VALIDATION_ERROR);let _=await this._loadData();if(_.length===0)return 0;let g=0;for(let O=0;O<_.length;O++)if(Ye(_[O],l)){let T={..._[O],...h};if(this._avroType.isValid(T,{errorHook:rt,noUndeclaredFields:!0})===!0)_[O]=T,g++;else throw new Le(`${fe}: Invalid document or schema`,U.DOCUMENT_VALIDATION_ERROR)}if(g>0){if(!await this._saveData(_))throw new le(`${fe}: Failed to update document`,U.S3_OPERATION_ERROR)}else if(d&&"upsert"in d&&d.upsert){if(!await this.insert(h))throw new le(`${fe}: Failed to update document`,U.S3_OPERATION_ERROR);g=1}return g}catch(_){throw _ instanceof le?_:new re(`Update operation failed: ${_.message}`,U.UPDATE_ERROR)}}async updateOne(l={},h={},d={}){try{if(l==null||h===void 0||h===null)throw new re("Query is required",U.MISSING_ARGUMENT);if(!this._avroType)throw new Se("Schema is not defined for this collection",U.SCHEMA_VALIDATION_ERROR);let _=await this._loadData();if(_.length===0)return 0;let g=_.findIndex(O=>Ye(O,l));if(g!==-1){let O={..._[g],...h};if(this._avroType.isValid(O,{errorHook:rt,noUndeclaredFields:!0})===!0){if(_[g]=O,!await this._saveData(_))throw new le(`${fe}: Failed to update document`,U.S3_OPERATION_ERROR);return 1}else throw new Le(`${fe}: Invalid document or schema`,U.DOCUMENT_VALIDATION_ERROR)}if(d&&"upsert"in d&&d.upsert){if(!await this.insert(h))throw new le(`${fe}: Failed to update document`,U.S3_OPERATION_ERROR);return 1}return 0}catch(_){throw _ instanceof re?_:new re(`UpdateOne operation failed: ${_.message}`,U.UPDATE_ONE_ERROR)}}async delete(l={}){try{if(l==null)throw new re("Query is required",U.MISSING_ARGUMENT);let h=await this._loadData();if(h.length===0)return 0;let d=h.length,_=h.filter(O=>!Ye(O,l));if(!await this._saveData(_))throw new le(`${fe}: Failed to delete document`,U.S3_OPERATION_ERROR);return d-_.length}catch(h){throw h instanceof le?h:new re(`Delete operation failed: ${h.message}`,U.DELETE_ERROR)}}async deleteAll(){try{let h=(await this._loadData()).length;if(!await this._saveData([]))throw new le(`${fe}: Failed to delete document`,U.S3_OPERATION_ERROR);return h}catch(l){throw l instanceof le?l:new re(`Delete operation failed: ${l.message}`,U.DELETE_ERROR)}}async count(l={}){try{return(await this.find(l)).length}catch(h){throw new re(`Count operation failed: ${h.message}`,U.COUNT_ERROR)}}async renameCollection(l,h=this._schema){try{if(qe(l),await this._s3.fileExists(`${this._dirPrefix}${Oe}${l}${Re}`))throw new re(`${fe}: Collection ${l} already exists`,U.COLLECTION_EXISTS);let _=h||this.getAvroSchema(),g=await this._loadData(),O=new St(l,_,this._s3,this._dirPrefix,this._safeWrite,this._chunkSize);return await O._saveData(g),await this._s3.delete(`${this._dirPrefix}${Oe}${this._colName}${Re}`),O}catch(d){throw d instanceof re?d:new re(`Rename collection failed: ${d.message}`,U.RENAME_COLLECTION_ERROR)}}};export{yr as lowstorage,re as lowstorageError,U as lowstorage_ERROR_CODES};
//# sourceMappingURL=lowstorage.min.js.map
